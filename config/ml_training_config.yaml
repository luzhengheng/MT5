# MT5-CRS 机器学习训练配置
# 对冲基金级别的预测引擎配置

# 数据路径配置
data:
  features_path: "outputs/features/features.parquet"  # 特征数据路径
  labels_path: "outputs/features/labels.parquet"      # 标签数据路径
  weights_path: "outputs/features/sample_weights.parquet"  # 样本权重路径
  pred_times_path: "outputs/features/pred_times.parquet"  # 标签结束时间路径

  # 训练/测试分割
  train_end_date: "2024-01-01"  # 训练集结束日期 (测试集从此日期开始)

  # 特征过滤 (删除原始价格列，只保留平稳特征)
  drop_features:
    - "open"
    - "high"
    - "low"
    - "close"
    - "volume"  # 如果存在原始成交量列

# 验证策略配置
validation:
  method: "purged_kfold"  # 'purged_kfold' 或 'walk_forward'

  # Purged K-Fold 配置
  purged_kfold:
    n_splits: 5
    embargo_pct: 0.01  # 禁运比例 (1%)
    purge_overlap: true

  # Walk Forward 配置 (备用)
  walk_forward:
    train_period_days: 730  # 2 年
    test_period_days: 90    # 3 个月
    step_days: 90

# 特征选择配置
feature_selection:
  enable: true
  method: "clustered_importance"  # 'clustered_importance' 或 'mda' 或 'none'

  # 特征聚类配置
  clustering:
    correlation_threshold: 0.75  # 相关性阈值
    selection_method: "importance"  # 'importance', 'variance', 'first'

  # MDA 特征重要性配置
  mda:
    n_repeats: 3
    scoring: "log_loss"  # 'accuracy' 或 'log_loss'
    top_n_features: 50  # 保留前 N 个特征

# 模型配置
models:
  # 模型架构选择
  architecture: "ensemble_stacking"  # 'lightgbm', 'catboost', 'ensemble_stacking'

  # LightGBM 配置
  lightgbm:
    objective: "binary"
    metric: "binary_logloss"
    boosting_type: "gbdt"
    num_leaves: 63
    learning_rate: 0.03
    feature_fraction: 0.8
    bagging_fraction: 0.8
    bagging_freq: 5
    lambda_l1: 0.5
    lambda_l2: 0.5
    min_child_samples: 30
    max_depth: 8
    verbose: -1
    n_jobs: -1
    num_boost_round: 2000
    early_stopping_rounds: 100

  # CatBoost 配置
  catboost:
    loss_function: "Logloss"
    eval_metric: "Logloss"
    iterations: 2000
    learning_rate: 0.03
    depth: 8
    l2_leaf_reg: 5.0
    random_strength: 1.0
    bagging_temperature: 1.0
    border_count: 128
    verbose: False
    thread_count: -1
    early_stopping_rounds: 100

  # Ensemble Stacking 配置
  ensemble:
    use_catboost: true  # 是否使用 CatBoost (如果未安装会自动跳过)

# Optuna 超参数优化配置
optuna:
  enable: false  # 是否启用超参数优化 (首次训练建议设为 false，使用默认参数)
  n_trials: 50   # 优化试验次数
  timeout: 3600  # 超时时间 (秒)
  metric: "f1"   # 优化指标: 'f1', 'accuracy', 'auc', 'logloss'
  direction: "maximize"  # 'maximize' 或 'minimize'

  # 搜索空间 (会覆盖上面的模型参数)
  search_space:
    num_leaves: [20, 150]
    learning_rate: [0.01, 0.3]
    feature_fraction: [0.5, 1.0]
    bagging_fraction: [0.5, 1.0]
    lambda_l1: [1e-8, 10.0]
    lambda_l2: [1e-8, 10.0]
    min_child_samples: [5, 100]
    max_depth: [3, 12]

# 评估配置
evaluation:
  # 基准模型对比
  compare_baseline: true
  baseline_strategies:
    - "random"      # 随机猜测
    - "momentum"    # 简单动量策略 (前一天涨 -> 预测涨)

  # 输出报告
  generate_reports: true
  report_formats:
    - "metrics"      # 指标 JSON
    - "plots"        # 图表 (ROC/PR/Calibration/SHAP)
    - "feature_importance"  # 特征重要性

  # SHAP 分析
  shap_analysis:
    enable: true
    max_samples: 1000  # 最大样本数 (SHAP 计算较慢)
    plot_type: "summary"  # 'summary', 'waterfall', 'force'

# 输出配置
output:
  model_dir: "outputs/models/ml_model_v1"
  plots_dir: "outputs/plots/ml_training"
  logs_dir: "outputs/logs"

  # 模型保存
  save_best_model: true
  save_all_folds: false  # 是否保存所有 fold 的模型

  # 实验追踪
  mlflow_tracking: true  # 是否使用 MLFlow 追踪实验 (Task #069)
  mlflow_uri: "http://localhost:5000"
  mlflow_experiment_name: "task_069_baseline"
  mlflow_run_name_template: "baseline_{model_type}_{timestamp}"

# 计算资源配置
compute:
  n_jobs: -1           # 并行任务数 (-1 = 全部 CPU)
  gpu: false           # 是否使用 GPU (LightGBM/CatBoost 支持)
  memory_limit_gb: 16  # 内存限制 (GB)

# 随机种子 (复现性)
random_seed: 42

# 日志配置
logging:
  level: "INFO"  # 'DEBUG', 'INFO', 'WARNING', 'ERROR'
  console: true
  file: true
  file_path: "outputs/logs/training.log"
