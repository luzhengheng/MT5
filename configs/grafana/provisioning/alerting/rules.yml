groups:
  - name: mt5_system_alerts
    rules:
    # 高优先级告警 - 系统关键服务
    - alert: HubServiceDown
      expr: up{job="mt5-hub"} == 0
      for: 1m
      labels:
        severity: critical
        service: hub
      annotations:
        summary: "中枢服务器服务宕机 ({{ $labels.instance }})"
        description: "中枢服务器关键服务已宕机超过1分钟，请立即检查"

    - alert: TrainingGPUUnavailable
      expr: up{job="mt5-training"} == 0
      for: 2m
      labels:
        severity: critical
        service: training
      annotations:
        summary: "训练服务器不可用 ({{ $labels.instance }})"
        description: "训练服务器连接失败，可能影响模型训练任务"

    - alert: InferenceServiceDown
      expr: up{job="mt5-inference"} == 0
      for: 1m
      labels:
        severity: critical
        service: inference
      annotations:
        summary: "推理服务宕机 ({{ $labels.instance }})"
        description: "推理服务不可用，影响生产环境预测功能"

    # 中优先级告警 - 性能监控
    - alert: HighCPUUsage
      expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
      for: 5m
      labels:
        severity: warning
        type: performance
      annotations:
        summary: "高CPU使用率 ({{ $labels.instance }})"
        description: "CPU使用率超过80%持续5分钟，建议检查系统负载"

    - alert: HighMemoryUsage
      expr: (1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100 > 85
      for: 5m
      labels:
        severity: warning
        type: performance
      annotations:
        summary: "高内存使用率 ({{ $labels.instance }})"
        description: "内存使用率超过85%持续5分钟，可能需要释放资源"

    - alert: HighDiskUsage
      expr: (node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100 < 15
      for: 10m
      labels:
        severity: warning
        type: storage
      annotations:
        summary: "磁盘空间不足 ({{ $labels.instance }})"
        description: "可用磁盘空间低于15%，建议清理存储空间"

    # 低优先级告警 - 业务监控
    - alert: DataSyncDelay
      expr: (time() - data_last_sync_timestamp) > 3600
      for: 15m
      labels:
        severity: info
        type: business
      annotations:
        summary: "数据同步延迟"
        description: "数据同步已超过1小时未更新，检查数据拉取任务"

    - alert: ModelAccuracyDrop
      expr: model_accuracy < 0.7
      for: 10m
      labels:
        severity: warning
        type: business
      annotations:
        summary: "模型准确率下降"
        description: "模型预测准确率低于70%，建议重新训练模型"

    - alert: SharpeRatioLow
      expr: sharpe_ratio < 0.5
      for: 30m
      labels:
        severity: info
        type: business
      annotations:
        summary: "夏普比率偏低"
        description: "策略夏普比率低于0.5，风险调整后收益不理想"

    # 网络连接告警
    - alert: CrossServerConnectivityIssue
      expr: probe_success{job="blackbox"} == 0
      for: 2m
      labels:
        severity: warning
        type: network
      annotations:
        summary: "跨服务器连接异常"
        description: "服务器间网络连接出现问题，影响自动化协作"

    # GPU监控（训练服务器）
    - alert: GPUUtilizationLow
      expr: gpu_utilization < 10
      for: 15m
      labels:
        severity: info
        type: hardware
      annotations:
        summary: "GPU利用率过低"
        description: "GPU利用率持续低于10%，可能存在资源浪费"

    - alert: GPUUtilizationHigh
      expr: gpu_utilization > 95
      for: 5m
      labels:
        severity: warning
        type: hardware
      annotations:
        summary: "GPU利用率过高"
        description: "GPU利用率超过95%，可能影响训练稳定性"

    # 推理服务监控
    - alert: InferenceResponseTimeHigh
      expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{job="mt5-inference"}[5m])) > 0.05
      for: 3m
      labels:
        severity: warning
        type: performance
      annotations:
        summary: "推理响应时间过高"
        description: "95%分位响应时间超过50ms，影响用户体验"
