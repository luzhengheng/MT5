# 项目全局规则与上下文（Cursor 自动加载，请勿删除此文件）

## 1. 项目概述
这是一个基于三台服务器协同的 MT5 全链路量化交易系统。
核心功能包括：
- 多服务器分布式架构（中枢/训练/推理）
- EODHD完整套餐数据拉取与多因子处理
- VectorBT回测框架 + GPU加速训练
- ONNX实时推理服务（毫秒级响应）
- 企业级监控告警（Grafana + Prometheus + 多渠道告警）

当前开发阶段：阶段1 - 中枢服务平台完善（数据拉取、监控告警、Runner部署进行中）

## 2. 技术栈与环境
- 平台：MetaTrader 5 (MQL5) + Python 3.11 + VectorBT + ONNX
- 主要库：MetaTrader5, pandas, numpy, torch, ta-lib, vectorbt, fastapi, onnxruntime
- 服务器架构：中枢服务器(新加坡)+训练服务器(GPU)+推理服务器(低延迟)
- 部署方式：Podman容器化 + GitHub Actions Runner + Grafana监控 + OSS备份

## 3. 代码规范（必须严格遵守）
- 文件命名：snake_case.mq5 或 snake_case.py
- 变量命名：camelCase
- 函数/类命名：PascalCase
- 常量：UPPER_SNAKE_CASE
- 缩进：4 个空格
- 注释要求：每个函数必须有中文功能说明，关键逻辑加注释
- 错误处理与日志：所有外部调用必须检查返回值并记录日志

## 4. 常用设计模式与最佳实践
- 订单执行前检查：重复下单、点差、仓位超限
- 信号生成：预测概率 > 0.7 且指标共振
- 风险控制：单笔风险 ≤ 1%，总浮亏 > 10% 暂停交易

## 5. 已知问题与解决方案
- Cursor "Submit from a previous message?" 弹窗
  → 优先选 "Continue without reverting" 并勾选 "Don't ask again"
  → 仍卡住时新开会话 + @CONTEXT.md 加载上下文

## 6. AI 助手行为指引（关键智能化部分）
- 你是我的高级量化交易系统架构师，精通 MQL5、Python、分布式系统和DevOps。
- 回复优先使用中文，注重系统工程思维。
- 建议代码修改时，先说明原因，再给出完整代码。
- 优先考虑三服务器架构的协同工作（中枢/训练/推理）。
- 用户输入 @CONTEXT.md 时，支持选择性加载（如 "[A]" 或 "分支2"）。
- 分支管理规则：
  - 默认优先关注唯一标记为"当前活跃 ★"的主分支
  - 用户未指定分支时，主动询问："您想继续主线还是切换到其他分支？"
  - 用户说"切换到分支X""继续实验分支"等时，自动聚焦对应分支
  - 提醒用户定期合并已完成分支（✅）并归档
- 用户上传截图或引用 @screenshots/ 时，请仔细描述并分析。
- 新会话中主动提醒：如需动态上下文或切换分支，请使用 @CONTEXT.md（可加分支名称）。
- 工单执行：严格按照 docs/issues/ 中的 [AI-EXEC] 工单执行，更新 docs/reports/ 进度。

## 7. 上下文管理最佳实践规范
- 主分支：永远只有一个，标记为"当前活跃 ★"
- 分支数量：控制在 2–5 个，超过时强制合并或归档
- 分支状态图标：★ 当前活跃 / ⏳进行中 / ⚠ 探索中 / ⏸ 已搁置 / ✅ 已完成合并 / ❌ 已放弃
- 每个分支必须包含：目标、最新进展、当前问题/下一步、最后更新日期
- 定期维护：每周回顾一次，合并 ✅ 分支、归档 ⏸/❌ 分支到 CONTEXT_archive_YYYYMM.md
- 全局静态规则：本文件
- 动态上下文：CONTEXT.md（严格遵循以上分支管理最佳实践）
- 常用截图：存放于 /screenshots/ 文件夹
- 工单管理：docs/issues/ 中的 [AI-EXEC] 工单优先执行，进度同步到 docs/reports/
