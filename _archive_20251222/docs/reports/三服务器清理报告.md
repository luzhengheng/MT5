# 三服务器 Root 目录清理报告

**执行日期**: 2025-12-19 18:20-18:35 UTC+8
**执行人**: Claude Sonnet 4.5
**状态**: ✅ 完成

---

## 一、执行摘要

成功清理三台服务器 root 目录下的历史冗余数据,释放约 **7.8GB** 磁盘空间,确保系统清爽高效运转。

### 清理成果

| 服务器 | 清理项目数 | 释放空间 | 磁盘使用率 |
|--------|----------|---------|----------|
| **中枢 (CRS)** | 3 项 | ~522MB | 17% (157G 可用) |
| **推理 (PIS)** | 7 项 | ~373MB | 21% (60G 可用) |
| **训练 (TRS)** | 1 项 | **~7.1GB** | 39% (23G 可用) |
| **总计** | **11 项** | **~8.0GB** | - |

---

## 二、中枢服务器 (CRS - 47.84.1.161)

### 清理详情

#### 1. ❌ 删除: `/root/directory_cleanup_backup_20251218_192534/`
- **大小**: 522MB
- **说明**: 历史备份目录,2024年12月18日创建
- **原因**: 已有新的 FHS 迁移备份机制

#### 2. ❌ 删除: `/root/mt5_backups/`
- **大小**: 16KB
- **内容**:
  - `backup_20251218_024145_MT5.tar.gz` (4KB)
  - `backup_20251218_024151_M-t-5-CRS.tar.gz` (4KB)
  - `pre-migration-backup-20251219/` (4KB)
- **原因**: 小型备份文件,已有正式备份在 `/root/.backup_m-t-5-crs_*/`

#### 3. ✅ 确认: `/root/M t 5-CRS/`
- **状态**: 目录不存在(已在之前迁移时处理)

### 保留项目

- ✅ `/opt/mt5-crs/` - 新的标准工作目录
- ✅ `/root/.backup_m-t-5-crs_*/` - FHS 迁移备份(安全回滚点)
- ✅ `/root/.ssh/`, `.config/`, `.cache/` - 系统配置
- ✅ `/root/actions-runner/` - GitHub Actions 运行器

### 清理后状态

- **磁盘使用**: 32G / 197G (17%)
- **Root 目录文件数**: 41 个
- **服务状态**: ✅ 所有容器服务正常运行

---

## 三、推理服务器 (PIS - 47.84.111.158)

### 清理详情

#### 1. ❌ 删除: `/root/python/`
- **大小**: 1.5MB
- **说明**: 旧 Python 代码目录
- **原因**: 已完整迁移到 `/opt/mt5-crs/src/`

#### 2. ❌ 删除: `/root/predict_env_backup.tar.gz`
- **大小**: 372MB (最大单个文件)
- **说明**: 旧环境备份压缩包
- **日期**: 2024年9月29日
- **原因**: 过时的环境备份,占用空间大

#### 3. ❌ 删除: `/root/__pycache__/`
- **说明**: Python 缓存目录
- **原因**: 自动生成的缓存,可随时重建

#### 4. ❌ 删除: 临时测试文件
- `_tmp_usdjpy_train_enrich.json` (620B)
- `_tmp_usdjpy_train_noenrich.json` (620B)
- **原因**: 临时测试数据文件

#### 5. ❌ 删除: 旧模型备份文件
- `nn_model.h5.bak_20251008` (270KB)
- `nn_model.h5.compat.h5` (284KB)
- `nn_model.scaler.pkl.bak_20251008` (641B)
- `nn_model.meta.json.bak_20251008` (797B)
- **说明**: 2024年10月8日的模型备份
- **原因**: 旧版本备份,保留最新版本即可

#### 6. ❌ 删除: 旧脚本文件
- `check_pkgs_remote.py` (1.9KB)
- `remote_patch_nginx.sh` (2.6KB)
- `remote_stop_training.sh` (692B)
- `deploy_nginx_reverse_proxy.ps1` (2.7KB)
- **原因**: 过时的远程管理脚本

#### 7. ❌ 删除: Optuna 相关文件
- `optuna_dash.log` (1.3KB)
- `init_optuna_db.py` (464B)
- `start_optuna_dashboard.sh` (559B)
- **原因**: 超参数优化工具的旧配置

### 保留项目

- ✅ `/opt/mt5-crs/` - 新的标准工作目录
- ✅ `/root/models/` - 当前模型目录
- ✅ `/root/datasets/` - 数据集目录
- ✅ `/root/backtests/` - 回测结果
- ✅ `/root/bin/` - 可执行脚本
- ✅ 当前版本模型文件:
  - `nn_model.h5` (284KB)
  - `nn_model.pt` (86KB)
  - `nn_model.scaler.pkl` (641B)
  - `nn_model.meta.json` (797B)

### 清理后状态

- **磁盘使用**: 16G / 79G (21%)
- **Root 目录文件数**: 42 个
- **服务状态**: ✅ 无容器服务(纯推理服务器)

---

## 四、训练服务器 (TRS - 8.138.100.136)

### 清理详情

#### 1. ❌ 删除: `/root/mt5train/` (两个同名目录)

**第一个 mt5train 目录 (主目录)**:
- **总大小**: 7.1GB
- **子目录结构**:
  - `venv/` - 7.0GB (Python 虚拟环境,占用最大)
  - `datasets/` - 135MB (训练数据集)
  - `python/` - 1.9MB (Python 代码)
  - `MQL5/` - 204KB (MQL5 文件)
  - `logs/` - 100KB (日志文件)
  - `tmp/` - 8KB (临时文件)
  - `data/` - 8KB (数据目录)

**第二个 mt5train 目录**:
- **大小**: 4KB (基本为空)
- **日期**: 2024年10月22日

**删除原因**:
- 旧的训练环境目录
- 虚拟环境占用 7GB,过于臃肿
- 代码和数据已迁移到 `/opt/mt5-crs/`
- 可以在新目录下按需重建虚拟环境

### 保留项目

- ✅ `/opt/mt5-crs/` - 新的标准工作目录
- ✅ 中文桌面目录 (系统默认):
  - 公共的, 模板, 视频, 图片, 文档, 下载, 音乐, 桌面

### 清理后状态

- **磁盘使用**: 15G / 40G (39%)
- **Root 目录文件数**: 41 个
- **释放空间**: **7.1GB** (最大单项清理)
- **服务状态**: ✅ 无容器服务(纯训练服务器)

---

## 五、清理影响评估

### 1. ✅ 服务完整性

**中枢服务器**:
- ✅ Redis (6379) - 运行中
- ✅ Redis Exporter (9121) - 运行中
- ✅ Prometheus (9090) - 运行中
- ✅ Alertmanager (9093) - 运行中
- ✅ Grafana (3000) - 运行中
- ✅ Node Exporter (9100) - 运行中

**推理/训练服务器**:
- ✅ `/opt/mt5-crs/` 目录完整
- ✅ 所有源代码文件正常
- ✅ 配置文件完整

### 2. ✅ 数据安全性

- ✅ 所有重要数据已迁移到 `/opt/mt5-crs/`
- ✅ FHS 迁移自动备份保留在 `/root/.backup_m-t-5-crs_*/`
- ✅ 删除的均为历史冗余或过时数据
- ✅ 当前模型文件已保留

### 3. ✅ 系统性能

**磁盘空间释放**:
- 中枢服务器: 522MB (从17% → 17%,空间充足)
- 推理服务器: 373MB (从22% → 21%)
- 训练服务器: 7.1GB (从53% → 39%,显著改善)

**文件组织**:
- Root 目录文件数保持精简 (40-42个)
- 工作文件统一在 `/opt/mt5-crs/`
- 目录结构清晰,易于维护

---

## 六、清理策略总结

### 删除标准

1. **历史备份**: 超过7天且有新备份机制
2. **旧代码**: 已完整迁移到新目录结构
3. **临时文件**: `__pycache__`, `tmp_*`, 日志文件
4. **过时环境**: 旧的虚拟环境 (venv/)
5. **备份文件**: `*.bak_*`, `*.backup` 后缀
6. **测试文件**: `_tmp_*`, 测试脚本

### 保留标准

1. **当前工作目录**: `/opt/mt5-crs/`
2. **安全备份**: FHS 迁移备份
3. **当前模型**: 最新版本模型文件
4. **系统配置**: `.ssh/`, `.config/`, `.cache/`
5. **活跃数据**: `models/`, `datasets/`, `backtests/`

---

## 七、后续建议

### 1. 定期清理计划

建议每月执行一次清理:
```bash
# 清理 Python 缓存
find /opt/mt5-crs -type d -name __pycache__ -exec rm -rf {} +

# 清理临时文件
find /opt/mt5-crs/tmp -type f -mtime +7 -delete

# 清理旧日志 (保留30天)
find /opt/mt5-crs/var/log -name "*.log" -mtime +30 -delete
```

### 2. 虚拟环境管理

在训练服务器上按需重建虚拟环境:
```bash
cd /opt/mt5-crs
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

**建议**: 使用 `--system-site-packages` 减少重复安装

### 3. 备份策略

- ✅ 保留 FHS 迁移备份至少 30 天
- ✅ 模型文件定期备份到 `/opt/mt5-crs/var/cache/models/`
- ✅ 数据集备份到外部存储

### 4. 监控告警

配置磁盘使用率告警:
- 警告阈值: 70%
- 严重阈值: 85%
- 自动清理: 超过 90% 时触发

---

## 八、验证清单

- [x] 所有三台服务器 root 目录已清理
- [x] `/opt/mt5-crs/` 目录完整且可访问
- [x] 中枢服务器所有容器服务正常运行
- [x] 推理服务器当前模型文件已保留
- [x] 训练服务器释放 7.1GB 空间
- [x] 磁盘使用率在健康范围 (< 50%)
- [x] 无重要数据丢失
- [x] 系统性能未受影响
- [x] 文档已更新

---

## 九、风险评估

| 风险项 | 风险等级 | 缓解措施 | 状态 |
|--------|----------|---------|------|
| 数据丢失 | 低 | FHS 迁移备份保留 | ✅ 已缓解 |
| 服务中断 | 低 | 清理后重启验证 | ✅ 已验证 |
| 模型丢失 | 低 | 保留当前版本模型 | ✅ 已保留 |
| 配置丢失 | 极低 | 系统配置未触碰 | ✅ 安全 |

---

## 十、结论

三服务器 root 目录清理工作顺利完成,达到预期目标:

✅ **空间释放**: 共释放约 8.0GB 磁盘空间
✅ **目录整洁**: Root 目录文件数维持在 40-42 个
✅ **服务正常**: 所有关键服务运行正常
✅ **数据安全**: 无重要数据丢失,备份完整
✅ **架构统一**: 三台服务器均采用 FHS 标准架构

系统现已处于清爽、高效的运转状态,为后续开发和部署提供良好的基础环境。

---

**报告生成**: 2025-12-19 18:35 UTC+8
**下一步**: 继续工单 #007 (FinBERT 部署) 或 工单 #009 (MT5 执行模块)
