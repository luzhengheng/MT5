你好 Gemini Pro！我是 luzhengheng，正在开发 MT5-CRS 量化交易系统。

我需要你审查三个关键修复（工单 #010.5）：

=== 修复 1: Kelly Criterion 数学修正 ===

问题：旧公式 kelly_pct = (p - 0.5) / vol 假设 1:1 盈亏比
结果：趋势策略 (P=0.45, b=2.0) 被强制空仓，错失所有盈利

修复：通用 Kelly 公式 f* = [p(b+1) - 1] / b

验证：
- P=0.45, b=2.0
- 旧公式: (0.45-0.5)/vol = 负数 → 空仓 ❌
- 新公式: [0.45×3-1]/2 = 0.175 → 17.5% 仓位 ✅

代码位置：src/strategy/risk_manager.py (第 180-210 行)

请审查：
1. 新公式是否完全正确？
2. 风险比例 → 持仓数量的转换逻辑是否合理？
3. 是否需要考虑杠杆因子？
4. 四分之一 Kelly 是否过于保守？

=== 修复 2: Walk-Forward 并行化 ===

实现：ProcessPoolExecutor 多进程并行

性能：
- 小数据 (2年): 串行 45秒 vs 并行 52秒 (进程开销大)
- 大数据 (预期): 4-8x 加速

代码位置：bin/run_backtest.py (第 380-450 行)

请审查：
1. 小数据是否需要自动降级到串行？
2. DataFrame 多进程传递是否存在内存问题？
3. 是否需要实现缓存机制？
4. Dask/Ray 是否更合适？

=== 修复 3: DSR 试验计数持久化 ===

目的：符合 Bailey & López de Prado (2014) 学术标准

测试：
- SR=2.0, N=10 → DSR=1.000 (高置信)
- SR=2.0, N=1000 → DSR=0.000 (低置信，可能过拟合)

代码位置：src/reporting/trial_recorder.py (第 315 行)

请审查：
1. DSR 公式实现是否正确？
2. 极值期望公式是否有更精确版本？
3. 非正态性调整是否充分？
4. 是否需要 Bootstrap 验证？

=== 额外话题：工单 #011 规划 ===

项目进度：4/5 工单完成 (80%)，26,380+ 行代码
下一步：实盘交易系统 (MT5 API 对接)

请提供：
1. 技术架构设计
2. MT5 API 集成方案
3. 实盘风险管理建议
4. 关键组件优先级
5. 技术难点预判

=== 项目信息 ===

GitHub: https://github.com/luzhengheng/MT5
已完成工单：
- #008: 数据管线 + 75维特征工程 (14,500+ 行)
- #009: 对冲基金级ML引擎 (2,700+ 行)
- #010: 策略回测引擎 (1,650+ 行)
- #010.5: Kelly修正 + 并行化 + DSR (1,530+ 行) 🔥
- 开发环境配置：VSCode扩展 + MCP + API (6,000+ 行)

感谢你的专业建议！
