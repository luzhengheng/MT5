# å¼€å‘ç¯å¢ƒå‘å±•æ”¹é©åˆ†æ”¯å®æ–½æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†æè¿°å¼€å‘ç¯å¢ƒå‘å±•æ”¹é©åˆ†æ”¯ï¼ˆdev-env-reform-v1.0ï¼‰çš„å®æ–½è¿‡ç¨‹ã€‚è¯¥åˆ†æ”¯åŸºäºä¸‰æœåŠ¡å™¨åˆ†å·¥æ–¹æ¡ˆï¼Œæ•´åˆå½“å‰æœ€æ–°å¼€å‘è¿›åº¦ï¼Œå®ç°ä¸­æ¢æœåŠ¡å¹³å°å®Œå–„å’Œè·¨æœåŠ¡å™¨è‡ªåŠ¨åŒ–åä½œï¼Œä¸ºé£é™©ç®¡ç†ä¸»åˆ†æ”¯æä¾›ç¨³å®šåŸºç¡€ã€‚

## å®æ–½ç›®æ ‡

### ä¸»è¦ç›®æ ‡
- **ä¸­æ¢æœåŠ¡å¹³å°ç”Ÿäº§åŒ–**ï¼šå®ç°99.9%å¯ç”¨æ€§ï¼Œå®Œå–„æœåŠ¡ç›‘æ§å’Œè‡ªåŠ¨åŒ–éƒ¨ç½²
- **è·¨æœåŠ¡å™¨åä½œæ¡†æ¶**ï¼šå»ºç«‹SSHè‡ªåŠ¨åŒ–è¿æ¥ï¼Œç»Ÿä¸€æœåŠ¡å™¨ç®¡ç†å’Œç›‘æ§
- **å¼€å‘ç¯å¢ƒæ•ˆç‡ä¼˜åŒ–**ï¼šæå‡å¼€å‘æ•ˆç‡30%ï¼Œå®Œå–„å·¥å…·é“¾å’Œæ–‡æ¡£ä½“ç³»
- **ä¸»åˆ†æ”¯å‰æä¿éšœ**ï¼šä¸ºé£é™©ç®¡ç†ä¼˜åŒ–åˆ†æ”¯æä¾›ç¨³å®šçš„å¼€å‘å’Œéƒ¨ç½²ç¯å¢ƒ

### éªŒæ”¶æ ‡å‡†
- [ ] ä¸­æ¢æœåŠ¡99.9%å¯ç”¨æ€§ï¼ˆé€šè¿‡ç‡â‰¥99.9%ï¼‰
- [ ] è·¨æœåŠ¡å™¨SSHè‡ªåŠ¨åŒ–é…ç½®å®Œæˆ
- [ ] å¤šçº§åˆ«å‘Šè­¦ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
- [ ] å¼€å‘æ•ˆç‡æå‡â‰¥30%
- [ ] CI/CDè‡ªåŠ¨åŒ–å·¥ä½œæµè¿è¡Œæ­£å¸¸

## å®æ–½é˜¶æ®µ

### é˜¶æ®µ1ï¼šåˆ†æ”¯åˆå§‹åŒ–ä¸é…ç½® âœ…
```bash
# 1. åˆ›å»ºæ”¹é©åˆ†æ”¯
git checkout -b dev-env-reform-v1.0

# 2. éªŒè¯åˆ†æ”¯å†…å®¹
git status
git log --oneline -5
```

**äº¤ä»˜ç‰©**ï¼š
- åˆ†æ”¯ `dev-env-reform-v1.0` åˆ›å»ºå®Œæˆ
- åŸºç¡€é…ç½®æ–‡ä»¶éªŒè¯é€šè¿‡

### é˜¶æ®µ2ï¼šæœåŠ¡å™¨é…ç½®çŸ©é˜µå»ºç«‹ âœ…
**é…ç½®æ–‡ä»¶**: `configs/server_matrix.yml`

**é…ç½®å†…å®¹**ï¼š
```yaml
servers:
  hub:         # ä¸­æ¢æœåŠ¡å™¨ - å¼€å‘/ç›‘æ§/è‡ªåŠ¨åŒ–
  training:    # è®­ç»ƒæœåŠ¡å™¨ - GPUç®—åŠ›/æ¨¡å‹è®­ç»ƒ
  inference:   # æ¨ç†æœåŠ¡å™¨ - ä½å»¶è¿Ÿ/ç”Ÿäº§æ¨ç†
```

**éªŒè¯å‘½ä»¤**ï¼š
```bash
python3 -c "import yaml; config=yaml.safe_load(open('configs/server_matrix.yml')); print('é…ç½®æœ‰æ•ˆ')"
```

### é˜¶æ®µ3ï¼šè·¨æœåŠ¡å™¨è‡ªåŠ¨åŒ–æ¡†æ¶éƒ¨ç½² ğŸ”„
**æ ¸å¿ƒè„šæœ¬**: `scripts/deploy/setup_cross_server_automation.sh`

**å®æ–½æ­¥éª¤**ï¼š
1. ç”ŸæˆSSHå¯†é’¥å¯¹
2. é…ç½®æœåŠ¡å™¨è¿æ¥
3. éƒ¨ç½²è‡ªåŠ¨åŒ–è„šæœ¬

**å…³é”®åŠŸèƒ½**ï¼š
- è‡ªåŠ¨SSHå¯†é’¥åˆ†å‘
- è¿æ¥æµ‹è¯•è„šæœ¬
- æœåŠ¡å™¨çŠ¶æ€ç›‘æ§

### é˜¶æ®µ4ï¼šDockerå®¹å™¨åŒ–æœåŠ¡æ ˆéƒ¨ç½² ğŸ”„
**é…ç½®æ–‡ä»¶**: `configs/docker/docker-compose.mt5-hub.yml`

**æœåŠ¡ç»„ä»¶**ï¼š
- **Grafana**: å¯è§†åŒ–ç›‘æ§é¢æ¿
- **Prometheus**: æŒ‡æ ‡æ”¶é›†æœåŠ¡
- **Node Exporter**: ç³»ç»ŸæŒ‡æ ‡å¯¼å‡º
- **Alertmanager**: å‘Šè­¦ç®¡ç†æœåŠ¡

**éƒ¨ç½²å‘½ä»¤**ï¼š
```bash
cd configs/docker
docker-compose -f docker-compose.mt5-hub.yml up -d
```

### é˜¶æ®µ5ï¼šå¤šçº§åˆ«ç›‘æ§å‘Šè­¦ä½“ç³»é…ç½® âœ…
**å‘Šè­¦è§„åˆ™**: `configs/grafana/provisioning/alerting/rules.yml`

**å‘Šè­¦çº§åˆ«**ï¼š
- **Critical**: æœåŠ¡å®•æœºã€ç³»ç»Ÿæ•…éšœ
- **Warning**: é«˜èµ„æºä½¿ç”¨ã€æ€§èƒ½é—®é¢˜
- **Info**: ä¸šåŠ¡æŒ‡æ ‡å¼‚å¸¸ã€çŠ¶æ€æé†’

**å‘Šè­¦é€šé“**ï¼š
- é’‰é’‰æœºå™¨äººé€šçŸ¥
- Slacké›†æˆï¼ˆå¯é€‰ï¼‰
- é‚®ä»¶å‘Šè­¦ï¼ˆæ‰©å±•ï¼‰

### é˜¶æ®µ6ï¼šå¼€å‘ç¯å¢ƒæ•ˆç‡ä¼˜åŒ–å·¥å…·é“¾ ğŸ”„
**ä¼˜åŒ–è„šæœ¬**: `scripts/setup/setup_dev_environment.sh`

**ä¼˜åŒ–å†…å®¹**ï¼š
- åŸºç¡€å·¥å…·è‡ªåŠ¨å®‰è£…
- Gité…ç½®å’Œåˆ«åè®¾ç½®
- Pythonè™šæ‹Ÿç¯å¢ƒé…ç½®
- SSHè¿æ¥ä¼˜åŒ–é…ç½®
- å¸¸ç”¨å‘½ä»¤åˆ«åå®šä¹‰

**æ•ˆç‡æå‡ç›®æ ‡**ï¼š
- ç¯å¢ƒéƒ¨ç½²æ—¶é—´å‡å°‘50%
- æ—¥å¸¸æ“ä½œå‘½ä»¤ç®€åŒ–
- é”™è¯¯æ’æŸ¥æ—¶é—´å‡å°‘

### é˜¶æ®µ7ï¼šCI/CDè‡ªåŠ¨åŒ–å·¥ä½œæµé…ç½® âœ…
**å·¥ä½œæµæ–‡ä»¶**: `.github/workflows/dev-env-reform.yml`

**å·¥ä½œæµé˜¶æ®µ**ï¼š
1. **validate-reform**: é…ç½®éªŒè¯
2. **test-connectivity**: è¿æ¥æµ‹è¯•
3. **health-check**: å¥åº·æ£€æŸ¥
4. **deploy-monitoring**: æœåŠ¡éƒ¨ç½²
5. **setup-automation**: è‡ªåŠ¨åŒ–é…ç½®
6. **performance-test**: æ€§èƒ½æµ‹è¯•
7. **generate-report**: æŠ¥å‘Šç”Ÿæˆ

## å®æ–½æ¸…å•

### å¿…æ£€æ¸…å•
- [x] åˆ†æ”¯åˆ›å»ºå’Œåˆå§‹åŒ–
- [x] æœåŠ¡å™¨é…ç½®çŸ©é˜µå»ºç«‹
- [x] è·¨æœåŠ¡å™¨è‡ªåŠ¨åŒ–è„šæœ¬å¼€å‘
- [x] DockeræœåŠ¡é…ç½®å®Œæˆ
- [x] ç›‘æ§å‘Šè­¦è§„åˆ™é…ç½®
- [x] å¼€å‘ç¯å¢ƒä¼˜åŒ–è„šæœ¬
- [x] CI/CDå·¥ä½œæµé…ç½®
- [ ] æœåŠ¡å™¨SSHå¯†é’¥æ‰‹åŠ¨éƒ¨ç½²
- [ ] DockeræœåŠ¡å®é™…éƒ¨ç½²éªŒè¯
- [ ] å…¨æœåŠ¡å™¨å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] å¼€å‘ç¯å¢ƒä¼˜åŒ–åº”ç”¨
- [ ] CI/CDå·¥ä½œæµæµ‹è¯•è¿è¡Œ

### éªŒè¯å‘½ä»¤
```bash
# 1. é…ç½®éªŒè¯
python3 -c "import yaml; yaml.safe_load(open('configs/server_matrix.yml'))"

# 2. Dockeré…ç½®éªŒè¯
docker-compose -f configs/docker/docker-compose.mt5-hub.yml config

# 3. è„šæœ¬æƒé™æ£€æŸ¥
ls -la scripts/deploy/setup_cross_server_automation.sh
ls -la scripts/monitor/health_check_all_servers.sh

# 4. è¿æ¥æµ‹è¯•
./scripts/monitor/test_server_connectivity.sh

# 5. å¥åº·æ£€æŸ¥
./scripts/monitor/health_check_all_servers.sh

# 6. å¼€å‘ç¯å¢ƒçŠ¶æ€
./scripts/dev/dev_status.sh
```

## ä½¿ç”¨æŒ‡å—

### æ—¥å¸¸å¼€å‘å‘½ä»¤
```bash
# ç¯å¢ƒçŠ¶æ€æ£€æŸ¥
mt5-status              # æœåŠ¡å™¨çŠ¶æ€æ€»è§ˆ
mt5-health             # å…¨æœåŠ¡å™¨å¥åº·æ£€æŸ¥
mt5-connectivity       # è¿æ¥æ€§æµ‹è¯•

# å¼€å‘ç¯å¢ƒç®¡ç†
venv-activate          # æ¿€æ´»Pythonç¯å¢ƒ
dev_status.sh          # å¼€å‘ç¯å¢ƒçŠ¶æ€
quick_deploy.sh        # å¿«é€Ÿéƒ¨ç½²

# æœåŠ¡ç®¡ç†
docker-stats           # Dockerå®¹å™¨çŠ¶æ€
docker-clean           # æ¸…ç†Dockerèµ„æº
```

### æœåŠ¡å™¨è¿æ¥
```bash
ssh mt5-hub            # è¿æ¥ä¸­æ¢æœåŠ¡å™¨
ssh mt5-training       # è¿æ¥è®­ç»ƒæœåŠ¡å™¨
ssh mt5-inference      # è¿æ¥æ¨ç†æœåŠ¡å™¨
```

### ç›‘æ§å’Œå‘Šè­¦
- **Grafanaé¢æ¿**: http://47.84.1.161:3000 (admin/MT5Hub@2025!Secure)
- **Prometheus**: http://47.84.1.161:9090
- **å‘Šè­¦é€šçŸ¥**: é’‰é’‰æœºå™¨äººè‡ªåŠ¨æ¨é€

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### SSHè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥å¯†é’¥é…ç½®
ls -la ~/.ssh/mt5_server_key*

# é‡æ–°ç”Ÿæˆå¯†é’¥
./scripts/deploy/setup_cross_server_automation.sh

# æ‰‹åŠ¨éƒ¨ç½²å¯†é’¥
ssh-copy-id -i ~/.ssh/mt5_server_key.pub root@TARGET_IP
```

#### DockeræœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :3000

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose -f configs/docker/docker-compose.mt5-hub.yml logs

# é‡æ–°éƒ¨ç½²
docker-compose -f configs/docker/docker-compose.mt5-hub.yml down
docker-compose -f configs/docker/docker-compose.mt5-hub.yml up -d
```

#### å¥åº·æ£€æŸ¥å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./scripts/monitor/health_check_all_servers.sh -v

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping 47.84.1.161
ping 8.138.100.136
ping 47.84.111.158

# éªŒè¯SSHè¿æ¥
ssh -o ConnectTimeout=5 root@47.84.1.161 "echo 'è¿æ¥æ­£å¸¸'"
```

#### CI/CDå·¥ä½œæµå¤±è´¥
```bash
# æ£€æŸ¥RunnerçŠ¶æ€
systemctl status actions-runner

# æŸ¥çœ‹Runneræ—¥å¿—
journalctl -u actions-runner --no-pager -n 20

# æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ
gh workflow run dev-env-reform.yml
```

## æ€§èƒ½æŒ‡æ ‡

### å¯ç”¨æ€§ç›®æ ‡
- **ç³»ç»Ÿå¯ç”¨æ€§**: â‰¥99.9%
- **æœåŠ¡å“åº”æ—¶é—´**: <50ms (æ¨ç†æœåŠ¡)
- **ç›‘æ§è¦†ç›–ç‡**: 100% (å…³é”®æœåŠ¡)

### æ•ˆç‡æå‡æŒ‡æ ‡
- **ç¯å¢ƒéƒ¨ç½²æ—¶é—´**: å‡å°‘50%
- **é—®é¢˜æ’æŸ¥æ—¶é—´**: å‡å°‘40%
- **æ—¥å¸¸æ“ä½œæ•ˆç‡**: æå‡30%

## åç»­è§„åˆ’

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2å‘¨ï¼‰
- [ ] å®Œå–„SSHå¯†é’¥è‡ªåŠ¨åŒ–éƒ¨ç½²
- [ ] ä¼˜åŒ–DockeræœåŠ¡ç¨³å®šæ€§
- [ ] æ‰©å±•ç›‘æ§æŒ‡æ ‡è¦†ç›–èŒƒå›´
- [ ] å®Œå–„å‘Šè­¦è§„åˆ™ç²¾ç»†åŒ–

### ä¸­æœŸç›®æ ‡ï¼ˆ1æœˆï¼‰
- [ ] å®ç°è®­ç»ƒæœåŠ¡å™¨ç¯å¢ƒæ ‡å‡†åŒ–
- [ ] éƒ¨ç½²æ¨ç†æœåŠ¡å™¨ç”Ÿäº§æœåŠ¡
- [ ] å»ºç«‹å®Œæ•´çš„CI/CDæµæ°´çº¿
- [ ] å®ç°æˆæœ¬ä¼˜åŒ–ç­–ç•¥

### é•¿æœŸç›®æ ‡ï¼ˆ3æœˆï¼‰
- [ ] å…¨é“¾è·¯è‡ªåŠ¨åŒ–éƒ¨ç½²
- [ ] æ™ºèƒ½ç›‘æ§å’Œè‡ªåŠ¨æ‰©å®¹
- [ ] 99.9%å¯ç”¨æ€§ä¿éšœä½“ç³»
- [ ] å¤šç¯å¢ƒååŒå¼€å‘æ¨¡å¼

## ç‰ˆæœ¬ä¿¡æ¯

- **åˆ†æ”¯ç‰ˆæœ¬**: dev-env-reform-v1.0
- **åè®®ç‰ˆæœ¬**: å·¥ä½œåŒºä¸Šä¸‹æ–‡åè®® V2.0
- **å®æ–½æ—¥æœŸ**: 2025-12-16
- **ç›®æ ‡å®Œæˆ**: 2025-12-20

---

**æ–‡æ¡£ç»´æŠ¤**: AI Agent
**æœ€åæ›´æ–°**: 2025-12-16
