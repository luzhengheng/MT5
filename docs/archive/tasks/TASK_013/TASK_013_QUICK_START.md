# TASK 013: SSH å¯†é’¥é…ç½®ä¸å…¨ç½‘åŒæ­¥ - å¿«é€Ÿæ“ä½œæŒ‡å—

**ç›®æ ‡**: é€šè¿‡å¯†ç è®¤è¯é…ç½® SSH å¯†é’¥ï¼Œå®ç° HUB å¯¹å„èŠ‚ç‚¹çš„æ— å¯†ç è®¿é—®å’Œè‡ªåŠ¨åŒæ­¥

---

## ğŸš€ æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ (æ¨è)

### Step 1: è¿è¡Œ SSH å¯†é’¥åˆ†å‘è„šæœ¬

```bash
cd /opt/mt5-crs
./scripts/maintenance/setup_ssh_keys.sh
```

**è„šæœ¬ä¼šæç¤ºæ‚¨è¾“å…¥å„èŠ‚ç‚¹çš„å¯†ç **:
- **INF (172.19.141.250)**: è¾“å…¥ root å¯†ç 
- **GTW (172.19.141.255)**: æ‰‹åŠ¨é…ç½® (è§ä¸‹æ–¹)
- **GPU (www.guangzhoupeak.com)**: è¾“å…¥ root å¯†ç 

### Step 2: æ‰‹åŠ¨é…ç½® GTW (Windows èŠ‚ç‚¹)

è„šæœ¬æ‰§è¡Œæ—¶ï¼Œä¼šæ˜¾ç¤ºæ‚¨çš„ SSH å…¬é’¥ã€‚è¯·åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œ:

```bash
# 1. ç™»å½• GTW (éœ€è¦è¾“å…¥å¯†ç )
ssh Administrator@172.19.141.255

# 2. åœ¨ Windows ä¸Šåˆ›å»º .ssh ç›®å½•
mkdir -p C:/Users/Administrator/.ssh

# 3. åˆ›å»º authorized_keys æ–‡ä»¶
notepad C:/Users/Administrator/.ssh/authorized_keys
```

ç„¶åå°†åœ¨ HUB ä¸Šæ˜¾ç¤ºçš„ SSH å…¬é’¥å†…å®¹ç²˜è´´åˆ°è®°äº‹æœ¬ä¸­ï¼Œä¿å­˜å¹¶é€€å‡ºã€‚

**SSH å…¬é’¥ç¤ºä¾‹** (ä»è„šæœ¬è¾“å‡ºä¸­å¤åˆ¶):
```
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC... root@hub
```

### Step 3: éªŒè¯ SSH è¿æ¥

```bash
# æµ‹è¯• INF
ssh root@172.19.141.250 "hostname"
# é¢„æœŸè¾“å‡º: sg-infer-core-01

# æµ‹è¯• GTW
ssh Administrator@172.19.141.255 "hostname"
# é¢„æœŸè¾“å‡º: sg-mt5-gateway-01

# æµ‹è¯• GPU
ssh root@www.guangzhoupeak.com "hostname"
# é¢„æœŸè¾“å‡º: cn-train-gpu-01
```

å¦‚æœä»¥ä¸Šå‘½ä»¤éƒ½æˆåŠŸä¸”**ä¸éœ€è¦è¾“å…¥å¯†ç **ï¼Œåˆ™é…ç½®æˆåŠŸï¼

### Step 4: æ‰§è¡Œå…¨ç½‘åŒæ­¥

```bash
cd /opt/mt5-crs
./scripts/maintenance/sync_nodes.sh
```

é¢„æœŸè¾“å‡º:
```
========================================
SYNCHRONIZATION SUMMARY
========================================
HUB Hash: 4936444...

INF: âœ“ SYNCED
GTW: âœ“ SYNCED
GPU: âœ“ SYNCED
========================================
```

---

## ğŸ”§ æ–¹æ³•äºŒï¼šæ‰‹åŠ¨é…ç½® (åˆ†æ­¥éª¤)

å¦‚æœè‡ªåŠ¨åŒ–è„šæœ¬é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œæ¯ä¸ªæ­¥éª¤ï¼š

### 1. é…ç½® INF èŠ‚ç‚¹

```bash
# ä½¿ç”¨ ssh-copy-id (éœ€è¦è¾“å…¥ INF çš„ root å¯†ç )
ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.19.141.250

# æµ‹è¯•è¿æ¥
ssh root@172.19.141.250 "echo 'SSH é…ç½®æˆåŠŸ'"
```

### 2. é…ç½® GTW èŠ‚ç‚¹ (Windows)

```bash
# ç™»å½• GTW
ssh Administrator@172.19.141.255
# è¾“å…¥å¯†ç åç»§ç»­

# åœ¨ Windows ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤
mkdir -p C:/Users/Administrator/.ssh
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC... root@hub" > C:/Users/Administrator/.ssh/authorized_keys
chmod 700 C:/Users/Administrator/.ssh
chmod 600 C:/Users/Administrator/.ssh/authorized_keys

# é€€å‡º GTW
exit
```

**æ³¨æ„**: å°†ä¸Šé¢çš„ `ssh-rsa AAAA...` æ›¿æ¢ä¸ºæ‚¨çš„å®é™…å…¬é’¥å†…å®¹ (åœ¨ HUB ä¸Šæ‰§è¡Œ `cat ~/.ssh/id_rsa.pub` æŸ¥çœ‹)ã€‚

### 3. é…ç½® GPU èŠ‚ç‚¹

```bash
# ä½¿ç”¨ ssh-copy-id (éœ€è¦è¾“å…¥ GPU çš„ root å¯†ç )
ssh-copy-id -i ~/.ssh/id_rsa.pub root@www.guangzhoupeak.com

# æµ‹è¯•è¿æ¥
ssh root@www.guangzhoupeak.com "echo 'SSH é…ç½®æˆåŠŸ'"
```

### 4. æ‰§è¡ŒåŒæ­¥

```bash
cd /opt/mt5-crs
./scripts/maintenance/sync_nodes.sh
```

---

## âœ… éªŒè¯åŒæ­¥æˆåŠŸ

åŒæ­¥å®Œæˆåï¼ŒéªŒè¯æ‰€æœ‰èŠ‚ç‚¹çš„ä¸€è‡´æ€§:

```bash
# è·å– HUB å½“å‰ Hash
HUB_HASH=$(git rev-parse HEAD)
echo "HUB Hash: $HUB_HASH"

# éªŒè¯å„èŠ‚ç‚¹
echo "INF Hash: $(ssh root@172.19.141.250 'cd /opt/mt5-crs && git rev-parse HEAD')"
echo "GTW Hash: $(ssh Administrator@172.19.141.255 'cd C:/mt5-crs && git rev-parse HEAD')"
echo "GPU Hash: $(ssh root@www.guangzhoupeak.com 'cd /opt/mt5-crs && git rev-parse HEAD')"
```

æ‰€æœ‰ Hash åº”è¯¥ä¸€è‡´ï¼

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ssh-copy-id å‘½ä»¤ä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**: æ‰‹åŠ¨å¤åˆ¶å…¬é’¥

```bash
# æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_rsa.pub

# ç™»å½•èŠ‚ç‚¹
ssh root@172.19.141.250

# åœ¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
mkdir -p ~/.ssh
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC... root@hub" >> ~/.ssh/authorized_keys
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

### é—®é¢˜ 2: Windows GTW èŠ‚ç‚¹è·¯å¾„é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ Git Bash è·¯å¾„

```bash
# åœ¨ Windows GTW ä¸Š
cd C:/Users/Administrator/.ssh
# æˆ–
cd ~/  # Git Bash ä¼šè‡ªåŠ¨æ˜ å°„åˆ°ç”¨æˆ·ä¸»ç›®å½•
```

### é—®é¢˜ 3: è¿æ¥è¶…æ—¶

**æ£€æŸ¥ç½‘ç»œ**:
```bash
ping 172.19.141.250  # INF
ping 172.19.141.255  # GTW
ping www.guangzhoupeak.com  # GPU
```

**æ£€æŸ¥ SSH æœåŠ¡**:
```bash
# åœ¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
systemctl status sshd
```

---

## ğŸ“ æ›´æ–°éªŒè¯æŠ¥å‘Š

åŒæ­¥æˆåŠŸåï¼Œæ›´æ–° [docs/logs/TASK_013_VERIFY.md](docs/logs/TASK_013_VERIFY.md):

```markdown
### Network Check
- [x] INF èŠ‚ç‚¹ Git Hash ä¸ HUB ä¸€è‡´ (4936444)
- [x] GTW èŠ‚ç‚¹ Git Hash ä¸ HUB ä¸€è‡´ (4936444)
- [x] GPU èŠ‚ç‚¹ Git Hash ä¸ HUB ä¸€è‡´ (4936444)

**çŠ¶æ€**: ğŸŸ¢ å…¨ç½‘åŒæ­¥å®Œæˆï¼Œæ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´
```

---

## ğŸ‰ å®Œæˆ

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ‚¨çš„ MT5-CRS åˆ†å¸ƒå¼ç³»ç»Ÿå°±å®ç°äº†å…¨ç½‘çŠ¶æ€ä¸€è‡´æ€§ï¼

**ä¸‹ä¸€æ­¥**: å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–å¼€å‘ä»»åŠ¡ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½å·²åŒæ­¥åˆ°æœ€æ–°çŠ¶æ€ã€‚

---

**åˆ›å»ºæ—¶é—´**: 2026-01-02
**åè®®**: MT5-CRS Development Protocol v3.4
**Generated by**: Claude Code
