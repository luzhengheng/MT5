# Task #126.1 AIå®¡æŸ¥è¯·æ±‚ - unified_review_gate.py (Protocol v4.4 Wait-or-Dieå®æ–½)

## å®¡æŸ¥æ–‡ä»¶ä¿¡æ¯
- æ–‡ä»¶: scripts/ai_governance/unified_review_gate.py
- ä¿®æ”¹èŒƒå›´: ç¬¬184-289è¡Œ (_send_requestæ–¹æ³•)
- æ ¸å¿ƒæ”¹è¿›: Wait-or-Dieæœºåˆ¶ (timeout=None + while Trueæ— é™å¾ªç¯)

## å…³é”®ä»£ç ç‰‡æ®µå¾…å®¡æŸ¥
```python
def _send_request(self, system_prompt: str, user_content: str, model: str = None) -> str:
    """[Protocol v4.4 Enhanced] å‘é€è¯·æ±‚åˆ°å¤–éƒ¨ AI ç½‘å…³"""
    
    # å…³é”®æ”¹åŠ¨ç‚¹1: timeout=None (ç¬¬238è¡Œ)
    response = requests.post(
        self.api_url,
        json=payload,
        headers=headers,
        impersonate="chrome110",
        timeout=None  # â† ä»åŸæ¥çš„400æ”¹ä¸ºNone
    )
    
    # å…³é”®æ”¹åŠ¨ç‚¹2: while Trueæ— é™å¾ªç¯ (ç¬¬230è¡Œ)
    while True:
        try:
            # ... 200 OK: å”¯ä¸€åˆæ³•å‡ºå£
            if response.status_code == 200:
                return result_text
            
            # 429/5xx: æ ‡å‡†é‡è¯•
            elif response.status_code in [429, 500, 502, 503, 504]:
                pass  # ç»§ç»­å¾ªç¯
            
            # 4xxé”™è¯¯: é•¿ç¡çœ 
            else:
                time.sleep(300)  # å¼ºåˆ¶ç­‰å¾…äººå·¥ä»‹å…¥
                continue
        except Exception as e:
            pass  # ç»§ç»­å¾ªç¯
        
        # æŒ‡æ•°é€€é¿é‡è¯•
        retry_delay = retry_delay * 1.5
```

## å®¡æŸ¥æ¸…å• (Checklist):

### ğŸ”´ å®‰å…¨æ€§å®¡æŸ¥ (Claude Logic Review)
1. [ ] æ— é™å¾ªç¯æ˜¯å¦ä¼šå¯¼è‡´èµ„æºæ³„æ¼? (æ£€æŸ¥: socket/å†…å­˜/è¿æ¥)
2. [ ] timeout=Noneæ˜¯å¦å¯èƒ½å¯¼è‡´åƒµå°¸è¿æ¥?
3. [ ] å¼‚å¸¸å¤„ç†æ˜¯å¦è¦†ç›–æ‰€æœ‰ç½‘ç»œæ•…éšœåœºæ™¯?
4. [ ] æ˜¯å¦å­˜åœ¨HTTP 401/403è¿™ç±»éœ€è¦äººå·¥ä»‹å…¥ä½†ä¼šè¿›å…¥æ­»å¾ªç¯çš„æƒ…å†µ?
5. [ ] æŒ‡æ•°é€€é¿çš„ä¸Šé™(max_delay=60s)æ˜¯å¦åˆç†?

### ğŸ“ æ¶æ„æ€§å®¡æŸ¥ (Gemini Context Review)
1. [ ] è¯¥æ”¹åŠ¨æ˜¯å¦è¿åéåˆ å‡åŸåˆ™? (ä¿ç•™äº†execute_plan/execute_reviewå—?)
2. [ ] Wait-or-Dieæœºåˆ¶æ˜¯å¦ä¸Protocol v4.4 Pillar Vç›¸ç¬¦?
3. [ ] æ˜¯å¦ç¼ºå°‘æ—¥å¿—è®°å½•é‡è¯•æ¬¡æ•°çš„åŠŸèƒ½?
4. [ ] å¼‚å¸¸ç±»å‹çš„åˆ†ç±»æ˜¯å¦è¶³å¤Ÿç»†è‡´? (ConnectionReset vs TimeoutError vs ChunkedEncodingError)
5. [ ] dev_loop.shä¸­stage_reviewæ˜¯å¦æ­£ç¡®è°ƒç”¨æ­¤æ–¹æ³•?

### ğŸ”— é›†æˆæ€§å®¡æŸ¥
1. [ ] è¯¥æ–¹æ³•æ˜¯å¦è¢«execute_planå’Œexecute_reviewæ­£ç¡®è°ƒç”¨?
2. [ ] æ˜¯å¦ä¸VERIFY_LOG.logçš„è®°å½•ä¸€è‡´?
3. [ ] æ˜¯å¦ä¸dev_loop.shçš„5é˜¶æ®µæµç¨‹åè°ƒ?

## é¢„æœŸå»ºè®®æ–¹å‘:
- ä»£ç è´¨é‡é—®é¢˜ (syntax/logic/security)
- æ€§èƒ½é—®é¢˜ (èµ„æºæ³„æ¼/æ­»å¾ªç¯/å†…å­˜å ç”¨)
- åè®®åˆè§„æ€§é—®é¢˜ (æ˜¯å¦æ»¡è¶³Protocol v4.4)
- é›†æˆæµ‹è¯•é—®é¢˜ (ä¸å…¶ä»–æ¨¡å—çš„å…¼å®¹æ€§)

## å…³é”®çº¦æŸ:
- ä¸¥ç¦æ¨èä»»ä½•ç»•è¿‡ç­‰å¾…çš„æ”¹åŠ¨
- ä¸¥ç¦å»ºè®®ä¿®æ”¹ä¸šåŠ¡é€»è¾‘
- ä¸¥ç¦åˆ é™¤å·²æœ‰çš„åŠŸèƒ½
