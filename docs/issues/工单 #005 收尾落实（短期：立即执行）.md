**工单 #005 收尾落实（短期：立即执行）**  
**工单标题**：#005 收尾 - PR 合并 + Release Tag 创建 + 系统验证 **发布时间**：2025年12月18日 **工单周期**：2025年12月18日 - 2025年12月19日 **系统更新**：生产就绪 | CI/CD 稳定 | 版本 v1.0 阶段开启 **验证人**：Grok & Claude  
🎯** 目标**  
完成 dev-env-reform-v1.0 分支的最终合并，创建正式 release tag，验证系统健康，确保 v1.0 环境改革阶段闭环。  
📋** 任务清单**  
1. **PR 最终审查与合并**（核心任务） **负责人**：你（或授权者） | **预计耗时**：15-30 分钟  
2. **PR 最终审查与合并**（核心任务） **负责人**：你（或授权者） | **预计耗时**：15-30 分钟  
3. **PR 最终审查与合并**（核心任务） **负责人**：你（或授权者） | **预计耗时**：15-30 分钟  
4. **PR 最终审查与合并**（核心任务） **负责人**：你（或授权者） | **预计耗时**：15-30 分钟  
5. **PR 最终审查与合并**（核心任务） **负责人**：你（或授权者） | **预计耗时**：15-30 分钟  
6. **PR 最终审查与合并**（核心任务） **负责人**：你（或授权者） | **预计耗时**：15-30 分钟  
    * 访问 PR URL：https://github.com/luzhengheng/MT5/compare/main…dev-env-reform-v1.0  
    * 检查：无冲突（若有冲突，先 rebase 或解决）。  
    * 审查变更：确认 20 个提交就绪，PR 描述完整（参考 /tmp/pr-description.md）。  
    * 合并方式：推荐 **Squash and Merge**（压缩为单个 commit，保持 main 历史干净）。  
    * 合并后：删除分支 dev-env-reform-v1.0。  
7. **创建 Annotated Release Tag**（最佳实践） **负责人**：你 | **预计耗时**：10 分钟  
8. **创建 Annotated Release Tag**（最佳实践） **负责人**：你 | **预计耗时**：10 分钟  
9. **创建 Annotated Release Tag**（最佳实践） **负责人**：你 | **预计耗时**：10 分钟  
10. **创建 Annotated Release Tag**（最佳实践） **负责人**：你 | **预计耗时**：10 分钟  
11. **创建 Annotated Release Tag**（最佳实践） **负责人**：你 | **预计耗时**：10 分钟  
12. **创建 Annotated Release Tag**（最佳实践） **负责人**：你 | **预计耗时**：10 分钟  
    * 最佳实践参考：Annotated tags 优于 lightweight tags，提供 tagger 信息、日期、消息，便于工具识别和 GitHub Release。  
    * 操作命令（本地或 GitHub Actions）： git checkout main  
    * git pull origin main  
    * git tag -a v1.0.0-env-reform -m "环境改革 v1.0：CI/CD 管道修复、容器化强化、监控就绪。包含 20 个提交优化。"  
    * git push origin v1.0.0-env-reform  
    *   
    * 在 GitHub 上：创建 Release（从 tag），附上 changelog（可从 PR 描述复制），可选上传 assets。  
13. **系统健康最终验证** **负责人**：你 | **预计耗时**：30-60 分钟  
14. **系统健康最终验证** **负责人**：你 | **预计耗时**：30-60 分钟  
15. **系统健康最终验证** **负责人**：你 | **预计耗时**：30-60 分钟  
16. **系统健康最终验证** **负责人**：你 | **预计耗时**：30-60 分钟  
17. **系统健康最终验证** **负责人**：你 | **预计耗时**：30-60 分钟  
18. **系统健康最终验证** **负责人**：你 | **预计耗时**：30-60 分钟  
    * 触发主 CI/CD pipeline（main-ci-cd.yml），确认通过。  
    * 检查监控：Prometheus/Grafana 仪表盘正常，Node Exporter 等指标采集。  
    * Docker 容器：cd configs/docker && docker compose up -d 后验证服务运行。  
    * 记录：所有 workflow 无硬错误，系统状态更新为“v1.0 就绪”。  
✅** 完成标志**  
* main 分支更新至最新 commit。  
* Tag v1.0.0-env-reform 存在并 push。  
* CI/CD 全绿，监控无警报。  
  
**工单 #006 - 驱动管家系统（高级迭代版：集成 Redis Streams 详细实现 + 高级配置）**  
**工单标题**：#006 驱动管家系统 - Redis Streams 生产级事件总线 + EODHD News API 接入 PoC **发布时间**：2025年12月19日（#005 闭环后启动） **工单周期**：2025年12月19日 - 2026年1月上旬（分阶段） **系统更新**：事件驱动（Redis Streams 高级） | 新闻过滤原型 | 数据管道 v2.0 **验证人**：Claude Code v4.5 & Grok  
🎯** 目标**  
基于 Redis Streams 详细实现与高级配置，构建生产级低延迟、高可靠、可观测的事件驱动架构，接入 EODHD News API，实现新闻过滤原型，为交易驱动事件管理提供坚实基础。  
📋** 任务清单（分阶段）**  
1. **Redis 服务端高级配置与部署**（第 1 周） **负责人**：核心 | **预计耗时**：2-4 天  
2. **Redis 服务端高级配置与部署**（第 1 周） **负责人**：核心 | **预计耗时**：2-4 天  
3. **Redis 服务端高级配置与部署**（第 1 周） **负责人**：核心 | **预计耗时**：2-4 天  
4. **Redis 服务端高级配置与部署**（第 1 周） **负责人**：核心 | **预计耗时**：2-4 天  
5. **Redis 服务端高级配置与部署**（第 1 周） **负责人**：核心 | **预计耗时**：2-4 天  
6. **Redis 服务端高级配置与部署**（第 1 周） **负责人**：核心 | **预计耗时**：2-4 天  
    * 更新 configs/docker/redis.conf：  
        * stream-node-max-bytes 8192、stream-node-max-entries 200（优化大 Stream 性能）。  
        * 启用 AOF 持久化：appendonly yes + appendfsync everysec（平衡耐久性与性能）。  
        * RDB 辅助：save 60 1。  
    * Docker Compose 添加 Redis 主从复制（可选 Sentinel 高可用）。  
    * 部署监控 exporter：  
        * oliver006/redis_exporter（通用指标）。  
        * chrnola/redis-streams-exporter（Streams 专用：lag、PEL、consumer 指标）。  
7. **Redis Streams 高级生产者/消费者实现**（第 1 周） **负责人**：核心 | **预计耗时**：4-6 天  
8. **Redis Streams 高级生产者/消费者实现**（第 1 周） **负责人**：核心 | **预计耗时**：4-6 天  
9. **Redis Streams 高级生产者/消费者实现**（第 1 周） **负责人**：核心 | **预计耗时**：4-6 天  
10. **Redis Streams 高级生产者/消费者实现**（第 1 周） **负责人**：核心 | **预计耗时**：4-6 天  
11. **Redis Streams 高级生产者/消费者实现**（第 1 周） **负责人**：核心 | **预计耗时**：4-6 天  
12. **Redis Streams 高级生产者/消费者实现**（第 1 周） **负责人**：核心 | **预计耗时**：4-6 天  
    * 新建目录 mt5/event_bus/，实现完整模块。  
    * 生产者：XADD 使用 maxlen ~ 30000 近似裁剪（原子 + 高性能）。  
    * 消费者组：  
        * news-filter-group 支持多实例负载均衡。  
        * 阻塞读取 BLOCK=5000ms。  
        * PEL 自动重试：优先使用 XAUTOCLAIM（min_idle_time_ms=300000，5min）。  
        * 批量处理 + 批量 ACK。  
        * 死信机制：失败多次（>3）移至 mt5:events:deadletter。  
    * Stream Key 规划：mt5:events:news_raw、mt5:events:news_filtered、mt5:events:deadletter。  
    * PoC 测试：启动多个消费者实例，模拟崩溃验证自动恢复与消息零丢失。  
13. **EODHD News API 接入与定时拉取**（第 1-2 周） **负责人**：核心 | **预计耗时**：3-5 天  
14. **EODHD News API 接入与定时拉取**（第 1-2 周） **负责人**：核心 | **预计耗时**：3-5 天  
15. **EODHD News API 接入与定时拉取**（第 1-2 周） **负责人**：核心 | **预计耗时**：3-5 天  
16. **EODHD News API 接入与定时拉取**（第 1-2 周） **负责人**：核心 | **预计耗时**：3-5 天  
17. **EODHD News API 接入与定时拉取**（第 1-2 周） **负责人**：核心 | **预计耗时**：3-5 天  
18. **EODHD News API 接入与定时拉取**（第 1-2 周） **负责人**：核心 | **预计耗时**：3-5 天  
    * 安装 eodhd 官方库，API Key 存 Secrets/环境变量。  
    * 实现定时任务（APScheduler 或 Celery beat，每 5-15 分钟）：  
        * 拉取 watchlist tickers 新闻（financial_news(s='AAPL.US', limit=50)）。  
        * 支持分页、限流、熔断。  
    * 事件发布：序列化为 JSON → mt5:events:news_raw。  
19. **新闻过滤原型与事件链路**（第 2 周） **负责人**：核心 | **预计耗时**：4-7 天  
20. **新闻过滤原型与事件链路**（第 2 周） **负责人**：核心 | **预计耗时**：4-7 天  
21. **新闻过滤原型与事件链路**（第 2 周） **负责人**：核心 | **预计耗时**：4-7 天  
22. **新闻过滤原型与事件链路**（第 2 周） **负责人**：核心 | **预计耗时**：4-7 天  
23. **新闻过滤原型与事件链路**（第 2 周） **负责人**：核心 | **预计耗时**：4-7 天  
24. **新闻过滤原型与事件链路**（第 2 周） **负责人**：核心 | **预计耗时**：4-7 天  
    * 消费者处理：从 news_raw → 过滤（sentiment > 0.5 + ticker 在 watchlist + 关键词匹配） → 发布 news_filtered。  
    * 可扩展：后续添加交易策略消费者组监听 news_filtered。  
    * 测试：端到端延迟 < 1s，准确率验证。  
25. **高级监控与警报集成**（第 2 周） **负责人**：核心 | **预计耗时**：3-4 天  
26. **高级监控与警报集成**（第 2 周） **负责人**：核心 | **预计耗时**：3-4 天  
27. **高级监控与警报集成**（第 2 周） **负责人**：核心 | **预计耗时**：3-4 天  
28. **高级监控与警报集成**（第 2 周） **负责人**：核心 | **预计耗时**：3-4 天  
29. **高级监控与警报集成**（第 2 周） **负责人**：核心 | **预计耗时**：3-4 天  
30. **高级监控与警报集成**（第 2 周） **负责人**：核心 | **预计耗时**：3-4 天  
    * Grafana Dashboard：导入/自定义 Streams 指标（stream_length、group_lag、pending_messages、consumer_lag）。  
    * 警报规则：  
        * PEL > 100  
        * Lag > 1000  
        * Stream length > 50000  
    * 集成钉钉 Webhook 警报。  
✅** 完成标志**  
* Redis 服务端高级配置就绪，持久化 + 监控 exporter 运行。  
* Streams 高级特性（XAUTOCLAIM、~ 裁剪、死信）完整实现，PoC 通过故障恢复测试。  
* EODHD News API 定时拉取 + 过滤链路通畅，合格新闻事件正常发布。  
* Prometheus/Grafana 全指标可视化，警报规则生效。  
* 全链路测试日志记录：消息零丢失、延迟 < 1s、可靠性达生产级标准。  
此高级迭代版全面融合 Redis Streams 详细实现与高级配置，使事件驱动系统具备交易场景所需的高性能、高可靠与强可观测性。项目进入生产级事件驱动阶段，稳步推进中！如需具体 redis.conf、exporter 配置或代码模板，随时指示。  
