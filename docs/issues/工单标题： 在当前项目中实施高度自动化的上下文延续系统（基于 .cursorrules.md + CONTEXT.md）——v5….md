**工单标题：** 在当前项目中实施高度自动化的上下文延续系统（基于 .cursor/rules.md + CONTEXT.md）——v5 迭代版（全面支持 CONTEXT.md 分支管理最佳实践）  
**目标：**在项目中建立一个高度智能化 + 高度自动化的上下文管理系统。新会话时，AI 通过自动加载 .cursor/rules.md 获得全局规则，通过 @CONTEXT.md（支持分块加载 + 多分支精准切换 + 状态图标 + 最佳实践规范）实现真正无感的动态上下文恢复，完美适配复杂项目多线并行、长期迭代开发场景。  
**目标：**在项目中建立一个高度智能化 + 高度自动化的上下文管理系统。新会话时，AI 通过自动加载 .cursor/rules.md 获得全局规则，通过 @CONTEXT.md（支持分块加载 + 多分支精准切换 + 状态图标 + 最佳实践规范）实现真正无感的动态上下文恢复，完美适配复杂项目多线并行、长期迭代开发场景。  
**要求：**  
**要求：**  
* 所有文件创建在当前项目根目录  
* CONTEXT.md 必须严格遵循分支管理最佳实践（单一主分支、状态图标、标准三要素、定期合并归档规范）  
* AI 行为指引中强化分支管理智能支持  
* 提供归档文件模板，便于长期维护  
**具体执行步骤（请严格按顺序执行）：**  
1. **创建 screenshots 文件夹**  
2. **创建 screenshots 文件夹**  
    * 在项目根目录下创建文件夹：screenshots  
    * 如果已存在则跳过  
3. **创建或更新项目全局规则文件：.cursor/rules.md**  
4. **创建或更新项目全局规则文件：.cursor/rules.md**  
    * 在项目根目录下创建/覆盖文件：.cursor/rules.md  
    * 写入以下完整内容（已全面融入分支管理最佳实践支持）：  
```
# 项目全局规则与上下文（Cursor 自动加载，请勿删除此文件）

## 1. 项目概述
这是一个 [请在此填写你的项目类型，例如：MT5 外汇交易 EA 系统]。
核心功能包括：
- 实时价格获取与 K 线处理
- 基于 Python 机器学习模型的信号预测
- 自动订单执行、仓位管理、风险控制
- 多品种、多周期支持

当前开发阶段：[例如：正在优化风险管理模块，集成实时预测服务]

## 2. 技术栈与环境
- 平台：MetaTrader 5 (MQL5) + Python 3.11
- 主要库：MetaTrader5, pandas, numpy, torch, ta-lib 等
- 部署方式：[例如：VPS 运行 EA + Flask/FastAPI 提供预测服务]

## 3. 代码规范（必须严格遵守）
- 文件命名：snake_case.mq5 或 snake_case.py
- 变量命名：camelCase
- 函数/类命名：PascalCase
- 常量：UPPER_SNAKE_CASE
- 缩进：4 个空格
- 注释要求：每个函数必须有中文功能说明，关键逻辑加注释
- 错误处理与日志：所有外部调用必须检查返回值并记录日志

## 4. 常用设计模式与最佳实践
- 订单执行前检查：重复下单、点差、仓位超限
- 信号生成：预测概率 > 0.7 且指标共振
- 风险控制：单笔风险 ≤ 1%，总浮亏 > 10% 暂停交易

## 5. 已知问题与解决方案
- Cursor “Submit from a previous message?” 弹窗
  → 优先选 “Continue without reverting” 并勾选 “Don’t ask again”
  → 仍卡住时新开会话 + @CONTEXT.md 加载上下文

## 6. AI 助手行为指引（关键智能化部分）
- 你是我的高级量化交易编程助手，精通 MQL5 和 Python。
- 回复优先使用中文。
- 建议代码修改时，先说明原因，再给出完整代码。
- 用户输入 @CONTEXT.md 时，支持选择性加载（如 “[A]” 或 “分支2”）。
- 分支管理规则：
  - 默认优先关注唯一标记为“当前活跃 ★”的主分支
  - 用户未指定分支时，主动询问：“您想继续主线还是切换到其他分支？”
  - 用户说“切换到分支X”“继续实验分支”等时，自动聚焦对应分支
  - 提醒用户定期合并已完成分支（✅）并归档
- 用户上传截图或引用 @screenshots/ 时，请仔细描述并分析。
- 新会话中主动提醒：如需动态上下文或切换分支，请使用 @CONTEXT.md（可加分支名称）。

## 7. 上下文管理最佳实践规范
- 主分支：永远只有一个，标记为“当前活跃 ★”
- 分支数量：控制在 2–5 个，超过时强制合并或归档
- 分支状态图标：★ 当前活跃 / ⏳进行中 / ⚠ 探索中 / ⏸ 已搁置 / ✅ 已完成合并 / ❌ 已放弃
- 每个分支必须包含：目标、最新进展、当前问题/下一步、最后更新日期
- 定期维护：每周回顾一次，合并 ✅ 分支、归档 ⏸/❌ 分支到 CONTEXT_archive_YYYYMM.md
- 全局静态规则：本文件
- 动态上下文：CONTEXT.md（严格遵循以上分支管理最佳实践）
- 常用截图：存放于 /screenshots/ 文件夹

```
5. **创建或更新动态上下文文件：CONTEXT.md（严格遵循最佳实践）**  
6. **创建或更新动态上下文文件：CONTEXT.md（严格遵循最佳实践）**  
    * 在项目根目录下创建/覆盖文件：CONTEXT.md  
    * 写入以下内容（完整分支管理最佳实践模板）：  
```
# 动态对话上下文（严格遵循分支管理最佳实践）

## [A] 当前主要任务（⏳进行中）
[在此填写当前核心任务，例如：
实现 MT5 订单执行模块的防重单逻辑。
需求：同一信号在 5 分钟内只允许下单一次，使用全局 Map 记录时间。]

## [B] 上次对话关键结论（✅ 已确认）
- 决定使用静态 map 记录最近下单时间
- Python 预测服务 API：http://your-vps-ip:5000/predict
- LSTM 模型阈值暂定 0.75，后续回测优化

## [C] 待确认的问题（❓待讨论）
1. 是否加入滑点补偿机制？
2. 多品种并发下如何避免资源争用？

## [D] 最近截图与文件引用
- Cursor 弹窗截图：@screenshots/cursor-submit-warning.png
- 相关核心代码文件：
  - 订单执行模块：@src/OrderExecutor.mq5
  - 预测客户端：@python/predict_client.py

## [E] 临时实验代码
```mql5
bool IsDuplicateOrder(string signalId) {
    static map lastOrderTime;
    datetime now = TimeCurrent();
    if (lastOrderTime.Contains(signalId) && now - lastOrderTime[signalId] < 300)
        return true;
    lastOrderTime[signalId] = now;
    return false;
}

```
## 分支管理（多线并行开发上下文 - 严格遵循最佳实践）  
**分支1：主线 - 风险管理优化（当前活跃 ★）**  
* 目标：构建稳健、可配置的风险控制体系  
* 最新进展：已实现单笔风险 1% 限制 + 总浮亏 10% 暂停机制  
* 当前问题/下一步：实现根据账户波动动态调整仓位  
* 最后更新：2025-12-15  
**分支2：实验性 - WebSocket 实时信号推送（探索中 ⚠）**  
* 目标：实现毫秒级信号推送，降低延迟  
* 最新进展：Python WebSocket server 原型完成，MQL5 客户端连接成功  
* 当前问题/下一步：平均延迟 800ms，主要瓶颈为 VPS 带宽；考虑升级或改用 MQTT  
* 最后更新：2025-12-10  
**分支3：备用方案 - Transformer 替换 LSTM（已搁置 **⏸**）**  
* 目标：评估更先进模型对预测准确率的提升  
* 最新进展：回测显示准确率 +3%，但推理延迟 +2.5 倍  
* 当前问题/下一步：资源消耗过高，不适合当前配置；暂不采纳  
* 最后更新：2025-12-05  
**分支4：新想法占位（空闲）**  
* 可用于未来新方向，直接在此开启新分支  
```
4. **创建归档模板文件（支持长期维护）**  
   - 在项目根目录下创建文件：`CONTEXT_archive_template.md`  
   - 内容如下（用于复制归档旧分支）：

```markdown
# CONTEXT.md 历史归档（YYYYMM）

## 归档日期：2025-12-15
## 归档原因：定期清理 / 分支完成 / 方案放弃

### 已归档分支记录
[在此粘贴已完成或放弃的分支完整内容，用于历史追溯]

```
5. **（可选）保存示例截图**  
6. **（可选）保存示例截图**  
    * 将相关截图保存到 screenshots/ 文件夹并更新 CONTEXT.md 中的引用  
7. **验证实施结果（必须执行）**  
8. **验证实施结果（必须执行）**  
    * 关闭当前会话  
    * 新开一个会话  
    * 测试1：直接输入 @CONTEXT.md → 确认 AI 默认聚焦主线分支（★）并体现最佳实践  
    * 测试2：输入 @CONTEXT.md 分支2 → 确认精准切换到实验分支  
    * 测试3：故意不指定分支 → 确认 AI 主动询问是否继续主线  
    * 测试4：输入 “请帮我合并分支2 到主线” → 确认 AI 能正确提取并建议更新  
9. **完成后回复确认**请回复以下内容：  
10. **完成后回复确认**请回复以下内容：  
```
高度自动化的上下文延续系统（v5）已实施完成：
- 已创建/更新 screenshots 文件夹和归档模板
- 已创建/更新 .cursor/rules.md（全面强化分支管理最佳实践）
- 已创建/更新 CONTEXT.md（严格遵循单一主分支、状态图标、三要素结构）
- 支持智能分支切换、主动询问、定期归档
- 项目已具备企业级长期迭代开发能力，上下文管理达到极致智能化

```
**结束语**执行完毕后，你的 Cursor 项目将拥有一个完全遵循分支管理最佳实践的上下文系统：主分支清晰、状态可视、自动智能、易于维护。从此多线并行开发如鱼得水，长期项目不再恐惧上下文丢失或混乱。  
现在请直接执行本工单。  
