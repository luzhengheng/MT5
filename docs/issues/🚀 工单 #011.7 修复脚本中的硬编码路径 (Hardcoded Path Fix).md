ğŸš€ å·¥å• #011.7: ä¿®å¤è„šæœ¬ä¸­çš„ç¡¬ç¼–ç è·¯å¾„ (Hardcoded Path Fix)

ä¼˜å…ˆçº§: P0 (æœ€é«˜ - ä¸¥é‡å½±å“å¯ç§»æ¤æ€§)
ç±»å‹: Refactoring / Infrastructure
ä¾èµ–: å·¥å• #011.6 (åŸºç¡€è®¾æ–½æ”¹è¿›å·²å®Œæˆ)
ç›®æ ‡: ç§»é™¤æ‰€æœ‰è„šæœ¬ä¸­ç¡¬ç¼–ç çš„ç»å¯¹è·¯å¾„ `/opt/mt5-crs/`ï¼Œæ”¹ç”¨åŠ¨æ€è·¯å¾„è·å–ï¼Œç¡®ä¿ä»£ç åœ¨ä¸åŒç¯å¢ƒï¼ˆWindowsã€Macã€Linuxï¼‰å’Œéƒ¨ç½²è·¯å¾„ä¸‹éƒ½èƒ½æ­£å¸¸è¿è¡Œã€‚

## ğŸ” é—®é¢˜æ ¹å›  (Root Cause Analysis)

**å‘ç°è€…**: Gemini Pro ä»£ç å®¡æŸ¥ (2025-12-22)

**å½±å“èŒƒå›´**: 6 ä¸ªè„šæœ¬æ–‡ä»¶
1. `scripts/update_notion_from_git.py` - ç¬¬ 48 è¡Œ: `PROJECT_ROOT = os.getenv("PROJECT_ROOT", "/opt/mt5-crs/")`
2. `scripts/setup_github_notion_sync.py` - ç¡¬ç¼–ç è·¯å¾„
3. `sync_notion_improved.py` - ç¬¬ 22 è¡Œ: `PROJECT_ROOT = os.getenv("PROJECT_ROOT", "/opt/mt5-crs/")`
4. `gemini_review_bridge.py` - å·²éƒ¨åˆ†ä¿®å¤ï¼ˆå·¥å• #011.6ï¼‰ï¼Œä½†éœ€å®Œæ•´éªŒè¯
5. å…¶ä»–å­ç›®å½•ä¸­çš„è„šæœ¬

**åæœ**:
- æ— æ³•åœ¨å¼€å‘æœºï¼ˆWindows/Macï¼‰ä¸Šè¿è¡Œè¿™äº›è„šæœ¬
- éƒ¨ç½²åˆ°ä¸åŒè·¯å¾„æ—¶éœ€è¦æ‰‹åŠ¨ä¿®æ”¹æºä»£ç 
- CI/CD ç³»ç»Ÿä¸­å¯èƒ½å› è·¯å¾„ä¸å­˜åœ¨è€Œå¤±è´¥
- ä¸¥é‡ç ´åä»£ç å¯ç§»æ¤æ€§ï¼Œè¿åæœ€ä½³å®è·µ

**å½“å‰è§£å†³æ–¹æ¡ˆçš„ç¼ºé™·**:
```python
# å½“å‰ï¼ˆä¸å¥½çš„åšæ³•ï¼‰
PROJECT_ROOT = os.getenv("PROJECT_ROOT", "/opt/mt5-crs/")
```
è¿™ç§æ–¹å¼ä¾ç„¶ä¾èµ–ç¯å¢ƒå˜é‡ï¼Œä¸”é»˜è®¤å€¼å›ºå®šä¸º Linux è·¯å¾„ã€‚

## ğŸ› ï¸ å®æ–½ä»»åŠ¡æ¸…å•

### 1. åŠ¨æ€è·¯å¾„è·å–å‡½æ•°
- æ–‡ä»¶: åˆ›å»ºæˆ–æ›´æ–° `src/utils/path_utils.py`
- å®ç°: åˆ›å»º `get_project_root()` å‡½æ•°ï¼Œä½¿ç”¨ä»¥ä¸‹ä¼˜å…ˆçº§ï¼š
  1. ç¯å¢ƒå˜é‡ `PROJECT_ROOT`ï¼ˆå¦‚æœè®¾ç½®ï¼‰
  2. `Path(__file__).parent.parent.parent` (ç›¸å¯¹äºè„šæœ¬ä½ç½®åŠ¨æ€è·å–)
  3. `os.getcwd()` (ä½œä¸ºæœ€åçš„å¤‡é€‰)
- ä»£ç ç¤ºä¾‹:
  ```python
  from pathlib import Path

  def get_project_root():
      """åŠ¨æ€è·å–é¡¹ç›®æ ¹ç›®å½•ï¼Œæ”¯æŒè·¨å¹³å°"""
      # ä¼˜å…ˆçº§ 1: ç¯å¢ƒå˜é‡
      if env_root := os.getenv("PROJECT_ROOT"):
          return Path(env_root).resolve()

      # ä¼˜å…ˆçº§ 2: åŸºäºè„šæœ¬ä½ç½®çš„ç›¸å¯¹è·¯å¾„
      # å‡è®¾è„šæœ¬åœ¨ scripts/ æˆ– src/ ä¸‹ï¼Œå‘ä¸Šèµ°å‡ çº§
      current_file = Path(__file__).resolve()
      for potential_root in [current_file.parent.parent, current_file.parent.parent.parent]:
          if (potential_root / ".git").exists():
              return potential_root

      # ä¼˜å…ˆçº§ 3: å½“å‰å·¥ä½œç›®å½•
      return Path.cwd()
  ```

### 2. ä¿®å¤ç›®æ ‡è„šæœ¬ (6 ä¸ªæ–‡ä»¶)

#### 2.1 `scripts/update_notion_from_git.py`
- ä½ç½®: ç¬¬ 48 è¡Œ
- ä¿®æ”¹:
  ```python
  # æ—§
  PROJECT_ROOT = os.getenv("PROJECT_ROOT", "/opt/mt5-crs/")

  # æ–°
  from src.utils.path_utils import get_project_root
  PROJECT_ROOT = get_project_root()
  ```

#### 2.2 `scripts/setup_github_notion_sync.py`
- æœç´¢å¹¶æ›¿æ¢æ‰€æœ‰ `/opt/mt5-crs/` ç¡¬ç¼–ç è·¯å¾„
- ä½¿ç”¨ `get_project_root()` æ›¿ä»£

#### 2.3 `sync_notion_improved.py`
- ç¬¬ 22 è¡Œä¿®æ”¹åŒä¸Š

#### 2.4 `gemini_review_bridge.py`
- å·²åœ¨å·¥å• #011.6 ä¸­æ”¹ä¸º `os.getcwd()`
- æœ¬æ¬¡æ”¹è¿›: æ”¹ç”¨ `get_project_root()` ç¡®ä¿ä¸€è‡´æ€§

#### 2.5 å…¶ä»–è„šæœ¬
- æ‰«æé¡¹ç›®ä¸­æ‰€æœ‰ `/opt/mt5-crs/` çš„å‡ºç°
- å…¨éƒ¨æ›¿æ¢ä¸º `get_project_root()`

### 3. éªŒè¯ä¿®å¤

- åŠ¨ä½œ: åœ¨ä»¥ä¸‹ç¯å¢ƒä¸­æµ‹è¯•æ¯ä¸ªè„šæœ¬ï¼š
  1. å½“å‰ Linux ç¯å¢ƒ (é»˜è®¤è·¯å¾„)
  2. éæ ‡å‡†è·¯å¾„ï¼ˆå¦‚ `/home/user/projects/mt5-crs`ï¼‰
  3. è®¾ç½® `PROJECT_ROOT` ç¯å¢ƒå˜é‡
  4. ä¸è®¾ç½® `PROJECT_ROOT` æ—¶çš„è‡ªåŠ¨æ£€æµ‹

- é¢„æœŸç»“æœ:
  - æ‰€æœ‰è„šæœ¬éƒ½èƒ½æ­£ç¡®æ‰¾åˆ°é¡¹ç›®æ ¹ç›®å½•
  - ä¸ä¾èµ–ç¯å¢ƒå˜é‡ä¹Ÿèƒ½è¿è¡Œï¼ˆå‘ä¸‹å…¼å®¹ï¼‰
  - é”™è¯¯æ¶ˆæ¯æ¸…æ™°æŒ‡å‡ºè·¯å¾„é—®é¢˜

### 4. æ·»åŠ è·¨å¹³å°å…¼å®¹æ€§

- ä½¿ç”¨ `pathlib.Path` è€Œéå­—ç¬¦ä¸²æ‹¼æ¥
- é¿å… `/` ç¡¬ç¼–ç ï¼Œä½¿ç”¨ `Path.joinpath()` æˆ– `/` æ“ä½œç¬¦
- ç¤ºä¾‹:
  ```python
  # ä¸å¥½
  git_dir = os.path.join(PROJECT_ROOT, ".git")

  # æ›´å¥½
  git_dir = Path(PROJECT_ROOT) / ".git"
  ```

## ğŸ’» ä»£ç å˜æ›´è§„èŒƒ (Technical Spec)

### åˆ›å»º `src/utils/path_utils.py`
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
è·¨å¹³å°è·¯å¾„å·¥å…·
æä¾›åŠ¨æ€ã€å¥å£®çš„é¡¹ç›®æ ¹ç›®å½•è·å–èƒ½åŠ›
"""

import os
from pathlib import Path


def get_project_root() -> Path:
    """
    åŠ¨æ€è·å–é¡¹ç›®æ ¹ç›®å½•ï¼Œæ”¯æŒå¤šç§ç¯å¢ƒå’Œéƒ¨ç½²è·¯å¾„

    ä¼˜å…ˆçº§ï¼š
    1. ç¯å¢ƒå˜é‡ PROJECT_ROOT
    2. åŸºäºè„šæœ¬ä½ç½®çš„ç›¸å¯¹è·¯å¾„æŸ¥æ‰¾ .git ç›®å½•
    3. å½“å‰å·¥ä½œç›®å½•

    Returns:
        Path: é¡¹ç›®æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„

    Raises:
        RuntimeError: æ— æ³•ç¡®å®šé¡¹ç›®æ ¹ç›®å½•æ—¶
    """
    # æ–¹æ¡ˆ 1: ç¯å¢ƒå˜é‡
    if env_root := os.getenv("PROJECT_ROOT"):
        root = Path(env_root).resolve()
        if root.exists():
            return root

    # æ–¹æ¡ˆ 2: å‘ä¸ŠæŸ¥æ‰¾ .git ç›®å½•
    current = Path(__file__).resolve().parent
    for _ in range(5):  # æœ€å¤šå‘ä¸ŠæŸ¥æ‰¾ 5 çº§
        if (current / ".git").exists():
            return current
        current = current.parent

    # æ–¹æ¡ˆ 3: å½“å‰å·¥ä½œç›®å½•
    cwd = Path.cwd()
    if (cwd / ".git").exists():
        return cwd

    # å¦‚æœä»æœªæ‰¾åˆ°ï¼Œè¿”å›å½“å‰ç›®å½•ä½†å‘å‡ºè­¦å‘Š
    return cwd


def get_config_dir() -> Path:
    """è·å–é…ç½®æ–‡ä»¶ç›®å½•"""
    return get_project_root() / "config"


def get_scripts_dir() -> Path:
    """è·å–è„šæœ¬ç›®å½•"""
    return get_project_root() / "scripts"


def get_src_dir() -> Path:
    """è·å–æºä»£ç ç›®å½•"""
    return get_project_root() / "src"


def get_docs_dir() -> Path:
    """è·å–æ–‡æ¡£ç›®å½•"""
    return get_project_root() / "docs"
```

## ğŸš€ æ‰§è¡ŒæŒ‡ä»¤

1. **åˆ›å»ºè·¯å¾„å·¥å…·æ¨¡å—**:
   ```bash
   touch src/utils/path_utils.py
   # ç„¶åå¤åˆ¶ä¸Šè¿°ä»£ç 
   ```

2. **ä¿®å¤ 6 ä¸ªè„šæœ¬**:
   ```bash
   # åœ¨æ¯ä¸ªè„šæœ¬é¡¶éƒ¨æ·»åŠ 
   from src.utils.path_utils import get_project_root

   # ç„¶åå°† PROJECT_ROOT èµ‹å€¼æ”¹ä¸º
   PROJECT_ROOT = get_project_root()
   ```

3. **éªŒè¯ä¿®å¤**:
   ```bash
   # æµ‹è¯•è„šæœ¬èƒ½å¦åœ¨ä¸åŒæ¡ä»¶ä¸‹æ‰¾åˆ°è·¯å¾„
   python3 scripts/update_notion_from_git.py --test
   ```

4. **æäº¤**:
   ```bash
   git add src/utils/path_utils.py scripts/ sync_notion_improved.py gemini_review_bridge.py
   git commit -m "refactor(paths): ç§»é™¤ç¡¬ç¼–ç è·¯å¾„ï¼Œå®ç°è·¨å¹³å°åŠ¨æ€è·¯å¾„è·å– #011.7"
   ```

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

- âœ… æ‰€æœ‰ 6 ä¸ªè„šæœ¬éƒ½ä½¿ç”¨åŠ¨æ€è·¯å¾„è·å–
- âœ… åœ¨é `/opt/mt5-crs/` è·¯å¾„ä¸‹ä»èƒ½æ­£å¸¸è¿è¡Œ
- âœ… ç¯å¢ƒå˜é‡ `PROJECT_ROOT` ä¼˜å…ˆçº§æœ€é«˜ï¼ˆå‘åå…¼å®¹ï¼‰
- âœ… é”™è¯¯æ¶ˆæ¯æ¸…æ™°ï¼Œä¾¿äºè°ƒè¯•
- âœ… é€šè¿‡ Linting æ£€æŸ¥ï¼ˆæ— ç¡¬ç¼–ç è·¯å¾„ï¼‰

## ğŸ”— å…³è”

- ä¾èµ–: å·¥å• #011.6 (åŸºç¡€è®¾æ–½æ”¹è¿›)
- å‰ç½®: æ— 
- åç»§: å·¥å• #011.8 (å¼‚æ­¥è§£è€¦)

