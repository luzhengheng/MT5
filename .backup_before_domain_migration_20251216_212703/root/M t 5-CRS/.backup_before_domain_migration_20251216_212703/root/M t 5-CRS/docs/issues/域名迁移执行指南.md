# åŸŸåè¿ç§»æ‰§è¡ŒæŒ‡å—

**åˆ›å»ºæ—¶é—´ï¼š** 2025-12-16
**ç›¸å…³å·¥å•ï¼š** é¡¹ç›®å…¨å±€åŸŸåè®¿é—®è§„èŒƒå®æ–½ä¸åˆ‡æ¢ï¼ˆåŸŸåè§£æå·²å®Œæˆï¼‰â€”â€”v1
**ç›®æ ‡ï¼š** æŒ‡å¯¼å¦‚ä½•ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬å®Œæˆé¡¹ç›®çš„ IP â†’ åŸŸåè¿ç§»

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### æœ€å¿«æ–¹å¼ï¼ˆ3 æ­¥ï¼‰

```bash
# 1ï¸âƒ£ æ›¿æ¢æ‰€æœ‰ IP ä¸ºåŸŸå
bash scripts/domain_migration/replace_ips_with_domains.sh

# 2ï¸âƒ£ é…ç½®æœ¬åœ° SSH ä¾¿æ·ç™»å½•
bash scripts/domain_migration/setup_ssh_config.sh

# 3ï¸âƒ£ éªŒè¯è¿ç§»æ˜¯å¦å®Œæˆ
bash scripts/domain_migration/verify_domain_migration.sh
```

---

## ğŸ“Š åŸŸåå¯¹ç…§è¡¨

| æœåŠ¡å™¨è§’è‰² | åŸŸå | æ—§ IP | SSH åˆ«å |
|-----------|------|-------|---------|
| **ä¸­æ¢æœåŠ¡å™¨** | www.crestive-code.com | 47.84.1.161 | crestive-code |
| **æ¨ç†æœåŠ¡å™¨** | www.crestive.com | 47.84.111.158 | crestive-inference |
| **è®­ç»ƒæœåŠ¡å™¨** | www.guangzhoupeak.com | 8.138.100.136 | guangzhoupeak |

---

## ğŸ”§ è„šæœ¬è¯¦è§£

### è„šæœ¬ 1: replace_ips_with_domains.sh

**ç›®çš„ï¼š** è‡ªåŠ¨æœç´¢å¹¶æ›¿æ¢é¡¹ç›®ä¸­çš„æ‰€æœ‰ IP åœ°å€ä¸ºå¯¹åº”åŸŸå

**æ‰§è¡Œæ–¹å¼ï¼š**
```bash
bash scripts/domain_migration/replace_ips_with_domains.sh
```

**å·¥ä½œæµç¨‹ï¼š**
1. âœ… æ£€æŸ¥é¡¹ç›®æ ¹ç›®å½•ç»“æ„
2. âœ… æœç´¢æ‰€æœ‰åŒ…å« IP çš„æ–‡ä»¶
3. ğŸ“‹ æ˜¾ç¤ºæ‰¾åˆ°çš„æ–‡ä»¶åˆ—è¡¨ï¼Œè¯¢é—®æ˜¯å¦ç»§ç»­
4. âœ… è‡ªåŠ¨åˆ›å»ºå¤‡ä»½ç›®å½•
5. ğŸ”„ é€ä¸ªæ›¿æ¢ IP ä¸ºåŸŸå
6. âœ… éªŒè¯æ›¿æ¢ç»“æœ
7. ğŸ“„ ç”Ÿæˆæ›¿æ¢æŠ¥å‘Š

**è¾“å‡ºæ–‡ä»¶ï¼š**
- å¤‡ä»½ï¼š`.backup_before_domain_migration_YYYYMMDD_HHMMSS/`
- æ—¥å¿—ï¼š`domain_migration_YYYYMMDD_HHMMSS.log`
- æŠ¥å‘Šï¼š`domain_migration_report_YYYYMMDD_HHMMSS.md`

**ç¤ºä¾‹æ‰§è¡Œï¼š**
```
è¯·ç¡®è®¤é¡¹ç›®æ ¹ç›®å½•: /root/M t 5-CRS
æ­£åœ¨æœç´¢åŒ…å« IP åœ°å€çš„æ–‡ä»¶...
æ‰¾åˆ° 15 ä¸ªåŒ…å« IP åœ°å€çš„æ–‡ä»¶ï¼š
  - docs/issues/å·¥å•æ ‡é¢˜ï¼š...
  - docs/knowledge/deployment/dev_env_reform_guide.md
  ... æ›´å¤šæ–‡ä»¶ ...

æ˜¯å¦ç»§ç»­æ‰§è¡Œæ›¿æ¢ï¼Ÿ[y/N] y

âœ… å¤‡ä»½å®Œæˆ: /root/M t 5-CRS/.backup_before_domain_migration_20251216_123456
âœ… æ›¿æ¢å®Œæˆï¼
  - ä¿®æ”¹æ–‡ä»¶æ•°: 8
  - æ€»æ›¿æ¢æ¬¡æ•°: 34
âœ… éªŒè¯é€šè¿‡ï¼æ‰€æœ‰ IP åœ°å€å·²æˆåŠŸæ›¿æ¢ä¸ºåŸŸå
âœ… æ›¿æ¢æŠ¥å‘Šå·²ç”Ÿæˆ: domain_migration_report_20251216_123456.md
```

---

### è„šæœ¬ 2: setup_ssh_config.sh

**ç›®çš„ï¼š** åœ¨æœ¬åœ°ç”µè„‘çš„ `~/.ssh/config` ä¸­æ·»åŠ å¿«é€Ÿç™»å½•åˆ«å

**æ‰§è¡Œæ–¹å¼ï¼š**
```bash
bash scripts/domain_migration/setup_ssh_config.sh
```

**å·¥ä½œæµç¨‹ï¼š**
1. âœ… æ£€æŸ¥ SSH ç›®å½•
2. âœ… å¤‡ä»½ç°æœ‰ SSH config
3. âœ… æ·»åŠ ä¸‰å°æœåŠ¡å™¨çš„åŸŸåé…ç½®
4. âœ… éªŒè¯é…ç½®
5. ğŸ”Œ æµ‹è¯•è¿æ¥
6. ğŸ“– æ˜¾ç¤ºä½¿ç”¨è¯´æ˜

**é…ç½®ç¤ºä¾‹ï¼ˆè‡ªåŠ¨ç”Ÿæˆåˆ° `~/.ssh/config`ï¼‰ï¼š**
```
# ä¸­æ¢æœåŠ¡å™¨ï¼ˆä¸»æ§ã€Grafanaã€Prometheusï¼‰
Host crestive-code
    HostName www.crestive-code.com
    User root
    Port 22
    ServerAliveInterval 60
    ServerAliveCountMax 3

# æ¨ç†æœåŠ¡å™¨ï¼ˆæ¨¡å‹æ¨ç†ã€å®æ—¶é¢„æµ‹ï¼‰
Host crestive-inference
    HostName www.crestive.com
    User root
    Port 22
    ServerAliveInterval 60
    ServerAliveCountMax 3

# è®­ç»ƒæœåŠ¡å™¨ï¼ˆæ¨¡å‹è®­ç»ƒã€å›æµ‹ï¼‰
Host guangzhoupeak
    HostName www.guangzhoupeak.com
    User root
    Port 22
    ServerAliveInterval 60
    ServerAliveCountMax 3
```

**å¿«é€Ÿç™»å½•å‘½ä»¤ï¼š**
```bash
ssh crestive-code              # è¿æ¥ä¸­æ¢æœåŠ¡å™¨
ssh crestive-inference         # è¿æ¥æ¨ç†æœåŠ¡å™¨
ssh guangzhoupeak              # è¿æ¥è®­ç»ƒæœåŠ¡å™¨
```

**å…¶ä»–å¸¸ç”¨å‘½ä»¤ï¼š**
```bash
# è¿œç¨‹æ‰§è¡Œå‘½ä»¤
ssh crestive-code 'hostname && uptime'

# æ–‡ä»¶ä¼ è¾“
scp file.txt crestive-code:/tmp/
scp crestive-code:/tmp/file.txt ./

# ç«¯å£è½¬å‘ï¼ˆè®¿é—®è¿œç¨‹ Grafanaï¼‰
ssh -L 3000:localhost:3000 crestive-code

# è¿œç¨‹ç¼–è¾‘
scp -r crestive-code:/root/project ./
```

---

### è„šæœ¬ 3: verify_domain_migration.sh

**ç›®çš„ï¼š** å…¨é¢æ£€æŸ¥åŸŸåè¿ç§»çš„å®Œæˆæƒ…å†µ

**æ‰§è¡Œæ–¹å¼ï¼š**
```bash
bash scripts/domain_migration/verify_domain_migration.sh
```

**æ£€æŸ¥é¡¹ç›®ï¼š**

| æ£€æŸ¥é¡¹ | è¯´æ˜ |
|--------|------|
| 1ï¸âƒ£ æ®‹ç•™ IP æ‰«æ | æŸ¥æ‰¾æ˜¯å¦è¿˜æœ‰æ—§ IP åœ°å€æœªè¢«æ›¿æ¢ |
| 2ï¸âƒ£ åŸŸåæ›¿æ¢éªŒè¯ | ç»Ÿè®¡å„åŸŸåçš„ä½¿ç”¨æ¬¡æ•° |
| 3ï¸âƒ£ SSH é…ç½®éªŒè¯ | æ£€æŸ¥ SSH config ä¸­æ˜¯å¦æœ‰ä¸‰ä¸ªåˆ«å |
| 4ï¸âƒ£ æ–‡æ¡£è§„èŒƒæ£€æŸ¥ | éªŒè¯ CONTEXT.md å’Œè§„åˆ™æ–‡ä»¶ä¸­çš„è§„èŒƒ |
| 5ï¸âƒ£ åŸŸåè¿æ¥æµ‹è¯• | DNS è§£æå’Œç«¯å£è¿é€šæ€§æµ‹è¯• |

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         åŸŸåè¿ç§»éªŒè¯è„šæœ¬                          â•‘
â•‘    æ£€æŸ¥ IP â†’ åŸŸåæ›¿æ¢çš„å®Œæˆæƒ…å†µ                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[âœ“] é¡¹ç›®æ ¹ç›®å½•æ­£ç¡®: /root/M t 5-CRS

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ£€æŸ¥ 1: æ®‹ç•™ IP åœ°å€æ‰«æ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[âœ“] æœªå‘ç°æ®‹ç•™ IP åœ°å€

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ£€æŸ¥ 2: åŸŸåæ›¿æ¢éªŒè¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[âœ“] www.crestive-code.com: å·²ä½¿ç”¨ (12 å¤„)
[âœ“] www.crestive.com: å·²ä½¿ç”¨ (8 å¤„)
[âœ“] www.guangzhoupeak.com: å·²ä½¿ç”¨ (6 å¤„)

... æ›´å¤šæ£€æŸ¥ä¿¡æ¯ ...

[âœ“] éªŒè¯å®Œæˆ - æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼
[âœ“] é¡¹ç›®å·²æˆåŠŸå®ŒæˆåŸŸåè¿ç§»
```

---

## ğŸ› ï¸ è¯¦ç»†æ“ä½œæ­¥éª¤

### æ­¥éª¤ 1: å‡†å¤‡å·¥ä½œ

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/M\ t\ 5-CRS

# åˆ›å»ºæ–°çš„ git åˆ†æ”¯ï¼ˆå¯é€‰ä½†æ¨èï¼‰
git checkout -b feature/domain-migration

# æŸ¥çœ‹è„šæœ¬æ˜¯å¦å­˜åœ¨ä¸”å¯æ‰§è¡Œ
ls -la scripts/domain_migration/
```

### æ­¥éª¤ 2: æ‰§è¡Œ IP æ›¿æ¢

```bash
# è¿è¡Œæ›¿æ¢è„šæœ¬
bash scripts/domain_migration/replace_ips_with_domains.sh

# è„šæœ¬ä¼šï¼š
# 1. æ˜¾ç¤ºé¡¹ç›®ç›®å½•
# 2. æœç´¢åŒ…å« IP çš„æ–‡ä»¶
# 3. è¯¢é—®æ˜¯å¦ç»§ç»­
# 4. åˆ›å»ºå¤‡ä»½
# 5. æ‰§è¡Œæ›¿æ¢
# 6. éªŒè¯ç»“æœ
# 7. ç”ŸæˆæŠ¥å‘Š
```

**å¦‚æœéœ€è¦å›æ»šï¼ˆæ›¿æ¢å‡ºé”™ï¼‰ï¼š**
```bash
# æŸ¥çœ‹å¤‡ä»½ç›®å½•
ls -la .backup_before_domain_migration_*

# ä»æœ€æ–°å¤‡ä»½æ¢å¤
cp -r .backup_before_domain_migration_20251216_123456/* ./

# æˆ–è€…ä» git æ¢å¤
git restore .
```

### æ­¥éª¤ 3: é…ç½® SSH

```bash
# è¿è¡Œ SSH é…ç½®è„šæœ¬
bash scripts/domain_migration/setup_ssh_config.sh

# è„šæœ¬ä¼šï¼š
# 1. æ£€æŸ¥ SSH ç›®å½•
# 2. å¤‡ä»½ç°æœ‰ config
# 3. æ·»åŠ ä¸‰å°æœåŠ¡å™¨é…ç½®
# 4. éªŒè¯é…ç½®
# 5. æµ‹è¯•è¿æ¥
# 6. æ˜¾ç¤ºä½¿ç”¨è¯´æ˜
```

**éªŒè¯ SSH é…ç½®ï¼š**
```bash
# æŸ¥çœ‹ SSH config é…ç½®
cat ~/.ssh/config | grep -A 4 "^Host crestive"

# æµ‹è¯•ç™»å½•ï¼ˆéœ€è¦è¾“å…¥å¯†ç æˆ–ä½¿ç”¨å¯†é’¥ï¼‰
ssh crestive-code 'hostname'
ssh crestive-inference 'hostname'
ssh guangzhoupeak 'hostname'
```

### æ­¥éª¤ 4: éªŒè¯è¿ç§»

```bash
# è¿è¡ŒéªŒè¯è„šæœ¬
bash scripts/domain_migration/verify_domain_migration.sh

# è„šæœ¬ä¼šè¿›è¡Œ 5 é¡¹æ£€æŸ¥å¹¶ç”ŸæˆæŠ¥å‘Š
# æŸ¥çœ‹ç”Ÿæˆçš„éªŒè¯æŠ¥å‘Š
cat domain_migration_verification_*.md
```

### æ­¥éª¤ 5: æäº¤å˜æ›´

```bash
# æŸ¥çœ‹æ‰€æœ‰å˜æ›´
git status

# æ·»åŠ å˜æ›´åˆ°æš‚å­˜åŒº
git add -A

# åˆ›å»º commitï¼ˆç¤ºä¾‹æäº¤ä¿¡æ¯ï¼‰
git commit -m "feat: å®Œæˆé¡¹ç›®å…¨å±€åŸŸåè¿ç§» - IP â†’ åŸŸå

- å°† 47.84.1.161 æ›¿æ¢ä¸º www.crestive-code.com
- å°† 47.84.111.158 æ›¿æ¢ä¸º www.crestive.com
- å°† 8.138.100.136 æ›¿æ¢ä¸º www.guangzhoupeak.com
- æ·»åŠ  SSH config ä¾¿æ·ç™»å½•é…ç½®
- æ›´æ–°æ‰€æœ‰æ–‡æ¡£ä¸­çš„æœåŠ¡å™¨è®¿é—®æ–¹å¼"

# æ¨é€åˆ°è¿œç¨‹ï¼ˆå¦‚æœæœ‰è¿œç¨‹ä»“åº“ï¼‰
git push origin feature/domain-migration
```

---

## âš™ï¸ é«˜çº§é…ç½®

### ä¿®æ”¹åŸŸåæ˜ å°„

å¦‚æœéœ€è¦ä¿®æ”¹ IP æˆ–åŸŸåçš„å¯¹åº”å…³ç³»ï¼Œç¼–è¾‘è„šæœ¬ä¸­çš„ä»¥ä¸‹éƒ¨åˆ†ï¼š

**replace_ips_with_domains.sh:**
```bash
declare -A IP_TO_DOMAIN=(
    ["æ—§IP"]="æ–°åŸŸå"
)
```

**setup_ssh_config.sh:**
```bash
declare -a SERVER_CONFIGS=(
    "Host|åˆ«å|HostName|åŸŸå|User|ç”¨æˆ·|Port|ç«¯å£|Comment|æè¿°"
)
```

### æ·»åŠ æ›´å¤šæ–‡ä»¶ç±»å‹

ç¼–è¾‘è„šæœ¬ä¸­çš„ï¼š
```bash
FILE_PATTERNS=(
    "*.md"
    "*.sh"
    # æ·»åŠ æ–°ç±»å‹
    "*.ä½ çš„æ‰©å±•å"
)
```

### æ’é™¤æ›´å¤šç›®å½•

ç¼–è¾‘è„šæœ¬ä¸­çš„ï¼š
```bash
EXCLUDE_DIRS=(
    ".git"
    "è¦æ’é™¤çš„ç›®å½•"
)
```

---

## â“ å¸¸è§é—®é¢˜

### Q: è„šæœ¬æ‰§è¡Œæƒé™é—®é¢˜

**ç—‡çŠ¶ï¼š** `bash: scripts/domain_migration/replace_ips_with_domains.sh: Permission denied`

**è§£å†³ï¼š**
```bash
chmod +x scripts/domain_migration/*.sh
```

### Q: SSH è¿æ¥è¶…æ—¶

**ç—‡çŠ¶ï¼š** `ssh crestive-code` è¶…æ—¶æˆ–è¿æ¥è¢«æ‹’ç»

**æ£€æŸ¥ï¼š**
```bash
# 1. éªŒè¯ DNS è§£æ
nslookup www.crestive-code.com

# 2. æ£€æŸ¥ç«¯å£è¿é€šæ€§
nc -zv www.crestive-code.com 22

# 3. æµ‹è¯• SSH è¯¦ç»†ä¿¡æ¯
ssh -v crestive-code

# 4. æ£€æŸ¥ SSH config é…ç½®
cat ~/.ssh/config | grep -A 4 "^Host crestive-code"
```

### Q: éªŒè¯è„šæœ¬æŠ¥å‘Šæ®‹ç•™ IP

**åŸå› ï¼š** å¯èƒ½æ˜¯æ³¨é‡Šã€ç¤ºä¾‹ä»£ç æˆ–æ–‡æ¡£å‚è€ƒ

**å¤„ç†ï¼š**
```bash
# æ‰¾åˆ°æ®‹ç•™ IP
grep -r "47\.84\|8\.138" . --include="*.md" --include="*.sh"

# ç¡®è®¤æ˜¯å¦éœ€è¦æ›¿æ¢
# å¦‚éœ€æ›¿æ¢ï¼Œæ‰‹åŠ¨ç¼–è¾‘æ–‡ä»¶
```

### Q: éœ€è¦å›æ»šæ‰€æœ‰å˜æ›´

**æ–¹æ³• 1ï¼šä»å¤‡ä»½æ¢å¤**
```bash
cp -r .backup_before_domain_migration_YYYYMMDD_HHMMSS/* ./
```

**æ–¹æ³• 2ï¼šä½¿ç”¨ git æ¢å¤**
```bash
git reset --hard HEAD~1
```

---

## ğŸ“ æ£€æŸ¥æ¸…å•

æ‰§è¡Œå®Œæ‰€æœ‰æ­¥éª¤åï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] è¿è¡Œ `replace_ips_with_domains.sh` å®Œæˆæ›¿æ¢
- [ ] æŸ¥çœ‹æ›¿æ¢æŠ¥å‘Šç¡®è®¤æ— é”™è¯¯
- [ ] è¿è¡Œ `setup_ssh_config.sh` é…ç½® SSH
- [ ] æµ‹è¯• SSH ç™»å½•å‘½ä»¤æ˜¯å¦æ­£å¸¸
- [ ] è¿è¡Œ `verify_domain_migration.sh` è¿›è¡Œå…¨é¢éªŒè¯
- [ ] æŸ¥çœ‹éªŒè¯æŠ¥å‘Šç¡®è®¤æ— é—æ¼
- [ ] åœ¨ git ä¸­æäº¤æ‰€æœ‰å˜æ›´
- [ ] é€šçŸ¥å›¢é˜Ÿæˆå‘˜ä½¿ç”¨æ–°çš„åŸŸåå’Œ SSH åˆ«å

---

## ğŸ“ æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹è„šæœ¬ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ï¼š`domain_migration_*.log`
2. æŸ¥çœ‹ç›¸å…³å·¥å•æ–‡æ¡£
3. å‚è€ƒæœ¬æŒ‡å—çš„"å¸¸è§é—®é¢˜"éƒ¨åˆ†
4. æ£€æŸ¥ `scripts/domain_migration/README.md` äº†è§£è„šæœ¬è¯¦æƒ…

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è„šæœ¬å·¥å…·é›†è¯´æ˜](./scripts/domain_migration/README.md)
- [åŸå§‹å·¥å•æ–‡æ¡£](./docs/issues/å·¥å•æ ‡é¢˜ï¼š é¡¹ç›®å…¨å±€åŸŸåè®¿é—®è§„èŒƒå®æ–½ä¸åˆ‡æ¢ï¼ˆåŸŸåè§£æå·²å®Œæˆï¼‰â€”â€”v1.md)
- [éƒ¨ç½²æŒ‡å—](./docs/knowledge/deployment/)
